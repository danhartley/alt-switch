{"version":3,"sources":["Bacon.js"],"names":["_slice","Array","prototype","slice","Bacon","toString","version","Exception","global","Error","nop","latter","_","x","former","cloneArray","xs","assert","message","condition","assertObservableIsProperty","_isObservable","_isProperty","assertEventStream","event","_isEventStream","assertObservable","assertFunction","f","isFunction","isArray","isObservable","assertArray","assertNoArguments","args","length","assertString","extend","target","arguments","i","prop","inherit","child","parent","hasProp","hasOwnProperty","ctor","key","call","symbol","Symbol","indexOf","y","indexWhere","head","always","negate","empty","tail","filter","filtered","push","map","result","each","Object","value","toArray","contains","id","last","all","undefined","any","without","remove","splice","fold","seed","flatMap","ys","concat","cached","None","_isNone","bind","fn","me","apply","obj","internals","recursionDepth","results","error","UpdateBarrier","rootEvent","waiterObs","waiters","aftersStack","aftersStackHeight","flushed","ensureStackHeight","h","afterTransaction","obs","stackIndexForThisObs","containsObs","listFromStack","processAfters","aftersList","stackSizeAtStart","topOfStack","topAfters","index","_topAfters$index","after","callSuccess","whenDoneWith","obsWaiters","flush","flushWaiters","deps","obsId","flushDepsOf","internalDeps","dep","inTransaction","context","currentEventId","wrappedSubscribe","sink","unsubd","shouldUnsub","doUnsub","unsub","dispatcher","subscribe","reply","noMore","hasWaiters","Source","sync","lazy","queue","_isSource","markEnded","ended","consume","mayHave","hasAtLeast","flatten","ConsumingSource","shift","c","BufferingSource","values","isTrigger","s","fromObservable","Desc","method","_isDesc","findDeps","describe","ref","_len","_key","withDesc","desc","withMethodCallSupport","wrapped","_len2","_key2","methodName","makeFunctionArgs","makeFunction_","partiallyApplied","applied","_len3","_key3","toSimpleExtractor","fieldValue","toFieldExtractor","parts","split","partFuncs","isFieldKey","charAt","_len4","_key4","makeFunction","convertArgsToFunction","sampled","sampledBy","p","_ref","_ref2","toCombinator","toFieldKey","left","right","Some","_isSome","getOrElse","get","forEach","isDefined","inspect","toOption","v","more","eventIdCounter","Event","_isEvent","isEvent","isEnd","isInitial","isNext","isError","hasValue","log","Next","valueF","eager","_isNext","valueInternal","fmap","Initial","_isInitial","toNext","End","initialEvent","nextEvent","endEvent","toEvent","idCounter","registerObs","Observable","initialDesc","subscribeInternal","onValue","onValues","onError","onEnd","name","_name","withDescription","assign","CompositeUnsubscribe","ss","unsubscribe","unsubscribed","subscriptions","starting","add","subscription","_this2","unsubMe","iterable","count","Dispatcher","_subscribe","_handleEvent","handleEvent","pushing","prevError","unsubSrc","hasSubscribers","removeSub","pushIt","pushToSubscriptions","tmp","len","sub","unsubscribeFromSource","_this","EventStream","handler","toProperty","initValue_","initValue","disp","Property","initSent","subbed","sendInit","toEventStream","withHandler","never","when","usage","sources","pats","patterns","patSources","constantToFunction","pat","ixs","triggerFound","j","k","ix","needsBarrier","containsDuplicateDeps","resultStream","triggers","ends","match","i1","cannotSync","source","cannotMatch","nonFlattened","trigger","part","unsubAll","flushLater","flushWhileTriggers","pop","events","i2","e","_p","observables","state","checkObservable","groupSimultaneous","_len5","streams","_key5","_len6","_key6","PropertyDispatcher","property","current","currentValueRootId","propertyEnded","maybeSubSource","_this3","dispatchingId","valId","changes","_this4","_this5","constant","fromBinder","binder","eventTransformer","unbound","shouldUnbind","unbind","unbinder","_len7","_key7","_len8","_key8","argumentsToObservables","argumentsToObservablesAndFunction","combineAsArray","stream","_len9","_key9","combineWith","_argumentsToObservablesAndFunction","combine","other","combinator","withStateMachine","initState","fromF","newState","outputs","output","equals","a","b","isNone","object","skipDuplicates","isEqual","prev","awaiting","not","and","or","scheduler","setTimeout","d","setInterval","clearInterval","clearTimeout","now","Date","getTime","bufferWithTime","delay","bufferWithTimeOrCount","Number","MAX_VALUE","bufferWithCount","flushOrSchedule","buffer","schedule","onInput","onFlush","scheduled","end","valuesToPush","_this6","delayMs","_this7","_len10","_key10","once","addPropertyInitValueToStream","justInitValue","unsubRight","unsubLeft","concatAll","flatMap_","makeSpawner","flatMapFirst","makeObservable","root","firstOnly","limit","rootDep","childDeps","composite","spawn","checkQueue","checkEnd","__","unsubRoot","flatMapWithConcurrencyLimit","_len11","_key11","flatMapConcat","later","sender","bufferingThrottle","minimumInterval","Bus","subscribeAll","guardedSink","newSink","subscribeInput","input","_this8","unsubscribeInput","plug","_this9","rootPush","pushQueue","liftCallback","callback","_len12","_key12","fromCallback","_len13","_key13","fromNodeCallback","_len14","_key14","combineTemplate","template","ctxStack","setValue","applyStreamValue","constantValue","mkContext","pushContext","newContext","containsObservables","constructor","compile","funcs","popContext","compileTemplate","rootContext","resultProperty","mapEnd","skipErrors","takeUntil","stopper","endMarker","withEndMarker","impl","_event$value","data","flatMapLatest","delayChanges","debounce","debounceImmediate","decode","cases","scan","_this10","acc","initHandled","next","diff","start","prevTuple","tuple","doAction","doEnd","doError","doLog","_len15","_key15","console","endOnError","_len16","_key16","errors","take","first","mapError","flatMapError","err","flatScan","updated","sampler","thisSource","samplerSource","sample","interval","_len17","_key17","reduce","eventMethods","findHandlerMethods","pair","methodPair","addListener","fromEventTarget","eventName","_findHandlerMethods","fromEvent","fromPoll","poll","valueAndEnd","fromPromise","promise","abort","bound","then","done","groupBy","keyF","limitF","src","similar","limited","fromArray","pushNeeded","holdWhen","valve","onHold","bufferedValues","srcIsEnded","subscribed","endIfBothEnded","toSend","$","asEventStream","selector","_this11","on","off","jQuery","Zepto","lastEvent","_len18","_key18","merge","mergeAll","smartSink","unsubBoth","sinks","repeatedly","repeat","generator","flag","subscribeNext","retry","options","retries","retriesDone","isRetryable","finished","valueStream","pause","sequentially","skip","skipUntil","starter","started","skipWhile","ok","_len19","_key19","slidingWindow","n","minValues","window","spies","running","spy","startWith","takeWhile","_len20","_key20","throttle","firstToPromise","PromiseCtr","_this12","Promise","resolve","reject","toPromise","update","initial","lateBindFirst","_len22","_key22","_len21","_key21","Function","zipAsArray","_len23","_key23","zipWith","_len24","_key24","_len25","_key25","observablesAndFunction","zip","ESObservable","observable","observerOrOnNext","onComplete","observer","complete","closed","cancel","toESObservable","fromESObservable","_observable","define","amd","module","exports"],"mappings":"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","file":"bfd256ba150d7f40328312b2d116c66c.map","sourcesContent":["(function() {\nvar _slice = Array.prototype.slice;\nvar Bacon = {\n  toString: function () {\n    return \"Bacon\";\n  }\n};\n\nBacon.version = '1.0.1';\n\nvar Exception = (typeof global !== \"undefined\" && global !== null ? global : this).Error;\nvar nop = function () {};\nvar latter = function (_, x) {\n  return x;\n};\nvar former = function (x, _) {\n  return x;\n};\nvar cloneArray = function (xs) {\n  return xs.slice(0);\n};\nvar assert = function (message, condition) {\n  if (!condition) {\n    throw new Exception(message);\n  }\n};\nvar assertObservableIsProperty = function (x) {\n  if ((x != null ? x._isObservable : void 0) && !(x != null ? x._isProperty : void 0)) {\n    throw new Exception(\"Observable is not a Property : \" + x);\n  }\n};\nvar assertEventStream = function (event) {\n  if (!(event != null ? event._isEventStream : void 0)) {\n    throw new Exception(\"not an EventStream : \" + event);\n  }\n};\n\nvar assertObservable = function (event) {\n  if (!(event != null ? event._isObservable : void 0)) {\n    throw new Exception(\"not an Observable : \" + event);\n  }\n};\nvar assertFunction = function (f) {\n  return assert(\"not a function : \" + f, _.isFunction(f));\n};\nvar isArray = Array.isArray || function (xs) {\n  return xs instanceof Array;\n};\nvar isObservable = function (x) {\n  return x && x._isObservable;\n};\nvar assertArray = function (xs) {\n  if (!isArray(xs)) {\n    throw new Exception(\"not an array : \" + xs);\n  }\n};\nvar assertNoArguments = function (args) {\n  return assert(\"no arguments supported\", args.length === 0);\n};\nvar assertString = function (x) {\n  if (typeof x === \"string\") {\n    throw new Exception(\"not a string : \" + x);\n  }\n};\n\nvar extend = function (target) {\n  var length = arguments.length;\n  for (var i = 1; 1 < length ? i < length : i > length; 1 < length ? i++ : i--) {\n    for (var prop in arguments[i]) {\n      target[prop] = arguments[i][prop];\n    }\n  }\n  return target;\n};\n\nvar inherit = function (child, parent) {\n  var hasProp = ({}).hasOwnProperty;\n  var ctor = function () {};\n  ctor.prototype = parent.prototype;\n  child.prototype = new ctor();\n  for (var key in parent) {\n    if (hasProp.call(parent, key)) {\n      child[key] = parent[key];\n    }\n  }\n  return child;\n};\n\nvar symbol = function (key) {\n  if (typeof Symbol !== \"undefined\" && Symbol[key]) {\n    return Symbol[key];\n  } else if (typeof Symbol !== \"undefined\" && typeof Symbol[\"for\"] === \"function\") {\n    return Symbol[key] = Symbol[\"for\"](key);\n  } else {\n    return \"@@\" + key;\n  }\n};\n\nvar _ = {\n  indexOf: (function () {\n    if (Array.prototype.indexOf) {\n      return function (xs, x) {\n        return xs.indexOf(x);\n      };\n    } else {\n      return function (xs, x) {\n        for (var i = 0, y; i < xs.length; i++) {\n          y = xs[i];\n          if (x === y) {\n            return i;\n          }\n        }\n        return -1;\n      };\n    }\n  })(),\n  indexWhere: function (xs, f) {\n    for (var i = 0, y; i < xs.length; i++) {\n      y = xs[i];\n      if (f(y)) {\n        return i;\n      }\n    }\n    return -1;\n  },\n  head: function (xs) {\n    return xs[0];\n  },\n  always: function (x) {\n    return function () {\n      return x;\n    };\n  },\n  negate: function (f) {\n    return function (x) {\n      return !f(x);\n    };\n  },\n  empty: function (xs) {\n    return xs.length === 0;\n  },\n  tail: function (xs) {\n    return xs.slice(1, xs.length);\n  },\n  filter: function (f, xs) {\n    var filtered = [];\n    for (var i = 0, x; i < xs.length; i++) {\n      x = xs[i];\n      if (f(x)) {\n        filtered.push(x);\n      }\n    }\n    return filtered;\n  },\n  map: function (f, xs) {\n    return (function () {\n      var result = [];\n      for (var i = 0, x; i < xs.length; i++) {\n        x = xs[i];\n        result.push(f(x));\n      }\n      return result;\n    })();\n  },\n  each: function (xs, f) {\n    for (var key in xs) {\n      if (Object.prototype.hasOwnProperty.call(xs, key)) {\n        var value = xs[key];\n        f(key, value);\n      }\n    }\n  },\n  toArray: function (xs) {\n    return isArray(xs) ? xs : [xs];\n  },\n  contains: function (xs, x) {\n    return _.indexOf(xs, x) !== -1;\n  },\n  id: function (x) {\n    return x;\n  },\n  last: function (xs) {\n    return xs[xs.length - 1];\n  },\n  all: function (xs) {\n    var f = arguments.length <= 1 || arguments[1] === undefined ? _.id : arguments[1];\n\n    for (var i = 0, x; i < xs.length; i++) {\n      x = xs[i];\n      if (!f(x)) {\n        return false;\n      }\n    }\n    return true;\n  },\n  any: function (xs) {\n    var f = arguments.length <= 1 || arguments[1] === undefined ? _.id : arguments[1];\n\n    for (var i = 0, x; i < xs.length; i++) {\n      x = xs[i];\n      if (f(x)) {\n        return true;\n      }\n    }\n    return false;\n  },\n  without: function (x, xs) {\n    return _.filter(function (y) {\n      return y !== x;\n    }, xs);\n  },\n  remove: function (x, xs) {\n    var i = _.indexOf(xs, x);\n    if (i >= 0) {\n      return xs.splice(i, 1);\n    }\n  },\n  fold: function (xs, seed, f) {\n    for (var i = 0, x; i < xs.length; i++) {\n      x = xs[i];\n      seed = f(seed, x);\n    }\n    return seed;\n  },\n  flatMap: function (f, xs) {\n    return _.fold(xs, [], function (ys, x) {\n      return ys.concat(f(x));\n    });\n  },\n  cached: function (f) {\n    var value = None;\n    return function () {\n      if (typeof value !== \"undefined\" && value !== null ? value._isNone : undefined) {\n        value = f();\n        f = undefined;\n      }\n      return value;\n    };\n  },\n  bind: function (fn, me) {\n    return function () {\n      return fn.apply(me, arguments);\n    };\n  },\n  isFunction: function (f) {\n    return typeof f === \"function\";\n  },\n  toString: function (obj) {\n    var internals, key, value;\n    var hasProp = ({}).hasOwnProperty;\n    try {\n      recursionDepth++;\n      if (obj == null) {\n        return \"undefined\";\n      } else if (_.isFunction(obj)) {\n        return \"function\";\n      } else if (isArray(obj)) {\n        if (recursionDepth > 5) {\n          return \"[..]\";\n        }\n        return \"[\" + _.map(_.toString, obj).toString() + \"]\";\n      } else if ((obj != null ? obj.toString : void 0) != null && obj.toString !== Object.prototype.toString) {\n        return obj.toString();\n      } else if (typeof obj === \"object\") {\n        if (recursionDepth > 5) {\n          return \"{..}\";\n        }\n        internals = (function () {\n          var results = [];\n          for (key in obj) {\n            if (!hasProp.call(obj, key)) continue;\n            value = (function () {\n              var error;\n              try {\n                return obj[key];\n              } catch (error) {\n                return error;\n              }\n            })();\n            results.push(_.toString(key) + \":\" + _.toString(value));\n          }\n          return results;\n        })();\n        return \"{\" + internals + \"}\";\n      } else {\n        return obj;\n      }\n    } finally {\n      recursionDepth--;\n    }\n  }\n};\n\nvar recursionDepth = 0;\n\nBacon._ = _;\n\nvar UpdateBarrier = Bacon.UpdateBarrier = (function () {\n  var rootEvent;\n  var waiterObs = [];\n  var waiters = {};\n  var aftersStack = [];\n  var aftersStackHeight = 0;\n  var flushed = {};\n\n  function ensureStackHeight(h) {\n    if (h <= aftersStackHeight) return;\n    if (!aftersStack[h - 1]) {\n      aftersStack[h - 1] = [[], 0];\n    }\n    aftersStackHeight = h;\n  }\n\n  var afterTransaction = function (obs, f) {\n    if (rootEvent || aftersStack.length) {\n      ensureStackHeight(1);\n      var stackIndexForThisObs = 0;\n      while (stackIndexForThisObs < aftersStackHeight - 1) {\n        if (containsObs(obs, aftersStack[stackIndexForThisObs][0])) {\n          break;\n        }\n        stackIndexForThisObs++;\n      }\n      var listFromStack = aftersStack[stackIndexForThisObs][0];\n      listFromStack.push([obs, f]);\n      if (!rootEvent) {\n        processAfters();\n      }\n    } else {\n        return f();\n      }\n  };\n\n  function containsObs(obs, aftersList) {\n    for (var i = 0; i < aftersList.length; i++) {\n      if (aftersList[i][0].id == obs.id) return true;\n    }\n    return false;\n  }\n\n  function processAfters() {\n    var stackSizeAtStart = aftersStackHeight;\n    if (!stackSizeAtStart) return;\n    while (aftersStackHeight >= stackSizeAtStart) {\n      var topOfStack = aftersStack[aftersStackHeight - 1];\n      if (!topOfStack) throw new Error(\"Unexpected stack top: \" + topOfStack);\n      var topAfters = topOfStack[0];\n      var index = topOfStack[1];\n\n      if (index < topAfters.length) {\n        var _topAfters$index = topAfters[index];\n        var obs = _topAfters$index[0];\n        var after = _topAfters$index[1];\n\n        topOfStack[1]++;\n        ensureStackHeight(aftersStackHeight + 1);\n        var callSuccess = false;\n        try {\n          after();\n          callSuccess = true;\n          while (aftersStackHeight > stackSizeAtStart && aftersStack[aftersStackHeight - 1][0].length == 0) {\n            aftersStackHeight--;\n          }\n        } finally {\n          if (!callSuccess) {\n            aftersStack = [];\n            aftersStackHeight = 0;\n          }\n        }\n      } else {\n          topOfStack[0] = [];\n          topOfStack[1] = 0;\n          break;\n        }\n    }\n  }\n\n  var whenDoneWith = function (obs, f) {\n    if (rootEvent) {\n      var obsWaiters = waiters[obs.id];\n      if (!(typeof obsWaiters !== \"undefined\" && obsWaiters !== null)) {\n        obsWaiters = waiters[obs.id] = [f];\n        return waiterObs.push(obs);\n      } else {\n        return obsWaiters.push(f);\n      }\n    } else {\n      return f();\n    }\n  };\n\n  var flush = function () {\n    while (waiterObs.length > 0) {\n      flushWaiters(0, true);\n    }\n    flushed = {};\n  };\n\n  var flushWaiters = function (index, deps) {\n    var obs = waiterObs[index];\n    var obsId = obs.id;\n    var obsWaiters = waiters[obsId];\n    waiterObs.splice(index, 1);\n    delete waiters[obsId];\n    if (deps && waiterObs.length > 0) {\n      flushDepsOf(obs);\n    }\n    for (var i = 0, f; i < obsWaiters.length; i++) {\n      f = obsWaiters[i];\n      f();\n    }\n  };\n\n  var flushDepsOf = function (obs) {\n    if (flushed[obs.id]) return;\n    var deps = obs.internalDeps();\n    for (var i = 0, dep; i < deps.length; i++) {\n      dep = deps[i];\n      flushDepsOf(dep);\n      if (waiters[dep.id]) {\n        var index = _.indexOf(waiterObs, dep);\n        flushWaiters(index, false);\n      }\n    }\n    flushed[obs.id] = true;\n  };\n\n  var inTransaction = function (event, context, f, args) {\n    if (rootEvent) {\n      return f.apply(context, args);\n    } else {\n      rootEvent = event;\n      try {\n        var result = f.apply(context, args);\n\n        flush();\n      } finally {\n        rootEvent = undefined;\n        processAfters();\n      }\n      return result;\n    }\n  };\n\n  var currentEventId = function () {\n    return rootEvent ? rootEvent.id : undefined;\n  };\n\n  var wrappedSubscribe = function (obs, sink) {\n    var unsubd = false;\n    var shouldUnsub = false;\n    var doUnsub = function () {\n      shouldUnsub = true;\n      return shouldUnsub;\n    };\n    var unsub = function () {\n      unsubd = true;\n      return doUnsub();\n    };\n    doUnsub = obs.dispatcher.subscribe(function (event) {\n      return afterTransaction(obs, function () {\n        if (!unsubd) {\n          var reply = sink(event);\n          if (reply === Bacon.noMore) {\n            return unsub();\n          }\n        }\n      });\n    });\n    if (shouldUnsub) {\n      doUnsub();\n    }\n    return unsub;\n  };\n\n  var hasWaiters = function () {\n    return waiterObs.length > 0;\n  };\n\n  return { whenDoneWith: whenDoneWith, hasWaiters: hasWaiters, inTransaction: inTransaction, currentEventId: currentEventId, wrappedSubscribe: wrappedSubscribe, afterTransaction: afterTransaction };\n})();\n\nfunction Source(obs, sync) {\n  var lazy = arguments.length <= 2 || arguments[2] === undefined ? false : arguments[2];\n\n  this.obs = obs;\n  this.sync = sync;\n  this.lazy = lazy;\n  this.queue = [];\n}\n\nextend(Source.prototype, {\n  _isSource: true,\n\n  subscribe: function (sink) {\n    return this.obs.dispatcher.subscribe(sink);\n  },\n  toString: function () {\n    return this.obs.toString();\n  },\n  markEnded: function () {\n    this.ended = true;\n    return true;\n  },\n  consume: function () {\n    if (this.lazy) {\n      return { value: _.always(this.queue[0]) };\n    } else {\n      return this.queue[0];\n    }\n  },\n  push: function (x) {\n    this.queue = [x];\n    return [x];\n  },\n  mayHave: function () {\n    return true;\n  },\n  hasAtLeast: function () {\n    return this.queue.length;\n  },\n  flatten: true\n});\n\nfunction ConsumingSource() {\n  Source.apply(this, arguments);\n}\n\ninherit(ConsumingSource, Source);\nextend(ConsumingSource.prototype, {\n  consume: function () {\n    return this.queue.shift();\n  },\n  push: function (x) {\n    return this.queue.push(x);\n  },\n  mayHave: function (c) {\n    return !this.ended || this.queue.length >= c;\n  },\n  hasAtLeast: function (c) {\n    return this.queue.length >= c;\n  },\n  flatten: false\n});\n\nfunction BufferingSource(obs) {\n  Source.call(this, obs, true);\n}\n\ninherit(BufferingSource, Source);\nextend(BufferingSource.prototype, {\n  consume: function () {\n    var values = this.queue;\n    this.queue = [];\n    return {\n      value: function () {\n        return values;\n      }\n    };\n  },\n  push: function (x) {\n    return this.queue.push(x.value());\n  },\n  hasAtLeast: function () {\n    return true;\n  }\n});\n\nSource.isTrigger = function (s) {\n  if (s != null ? s._isSource : void 0) {\n    return s.sync;\n  } else {\n    return s != null ? s._isEventStream : void 0;\n  }\n};\n\nSource.fromObservable = function (s) {\n  if (s != null ? s._isSource : void 0) {\n    return s;\n  } else if (s != null ? s._isProperty : void 0) {\n    return new Source(s, false);\n  } else {\n    return new ConsumingSource(s, true);\n  }\n};\n\nfunction Desc(context, method, args) {\n  this.context = context;\n  this.method = method;\n  this.args = args;\n}\n\nextend(Desc.prototype, {\n  _isDesc: true,\n  deps: function () {\n    if (!this.cached) {\n      this.cached = findDeps([this.context].concat(this.args));\n    }\n    return this.cached;\n  },\n  toString: function () {\n    return _.toString(this.context) + \".\" + _.toString(this.method) + \"(\" + _.map(_.toString, this.args) + \")\";\n  }\n});\n\nvar describe = function (context, method) {\n  var ref = context || method;\n  if (ref && ref._isDesc) {\n    return context || method;\n  } else {\n    for (var _len = arguments.length, args = Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {\n      args[_key - 2] = arguments[_key];\n    }\n\n    return new Desc(context, method, args);\n  }\n};\n\nvar withDesc = function (desc, obs) {\n  obs.desc = desc;\n  return obs;\n};\n\nvar findDeps = function (x) {\n  if (isArray(x)) {\n    return _.flatMap(findDeps, x);\n  } else if (isObservable(x)) {\n    return [x];\n  } else if (typeof x !== \"undefined\" && x !== null ? x._isSource : undefined) {\n    return [x.obs];\n  } else {\n    return [];\n  }\n};\n\nBacon.Desc = Desc;\nBacon.Desc.empty = new Bacon.Desc(\"\", \"\", []);\n\nvar withMethodCallSupport = function (wrapped) {\n  return function (f) {\n    for (var _len2 = arguments.length, args = Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n      args[_key2 - 1] = arguments[_key2];\n    }\n\n    if (typeof f === \"object\" && args.length) {\n      var context = f;\n      var methodName = args[0];\n      f = function () {\n        return context[methodName].apply(context, arguments);\n      };\n      args = args.slice(1);\n    }\n    return wrapped.apply(undefined, [f].concat(args));\n  };\n};\n\nvar makeFunctionArgs = function (args) {\n  args = Array.prototype.slice.call(args);\n  return makeFunction_.apply(undefined, args);\n};\n\nvar partiallyApplied = function (f, applied) {\n  return function () {\n    for (var _len3 = arguments.length, args = Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n      args[_key3] = arguments[_key3];\n    }\n\n    return f.apply(undefined, applied.concat(args));\n  };\n};\n\nvar toSimpleExtractor = function (args) {\n  return function (key) {\n    return function (value) {\n      if (!(typeof value !== \"undefined\" && value !== null)) {\n        return;\n      } else {\n        var fieldValue = value[key];\n        if (_.isFunction(fieldValue)) {\n          return fieldValue.apply(value, args);\n        } else {\n          return fieldValue;\n        }\n      }\n    };\n  };\n};\n\nvar toFieldExtractor = function (f, args) {\n  var parts = f.slice(1).split(\".\");\n  var partFuncs = _.map(toSimpleExtractor(args), parts);\n  return function (value) {\n    for (var i = 0, f; i < partFuncs.length; i++) {\n      f = partFuncs[i];\n      value = f(value);\n    }\n    return value;\n  };\n};\n\nvar isFieldKey = function (f) {\n  return typeof f === \"string\" && f.length > 1 && f.charAt(0) === \".\";\n};\n\nvar makeFunction_ = withMethodCallSupport(function (f) {\n  for (var _len4 = arguments.length, args = Array(_len4 > 1 ? _len4 - 1 : 0), _key4 = 1; _key4 < _len4; _key4++) {\n    args[_key4 - 1] = arguments[_key4];\n  }\n\n  if (_.isFunction(f)) {\n    if (args.length) {\n      return partiallyApplied(f, args);\n    } else {\n      return f;\n    }\n  } else if (isFieldKey(f)) {\n    return toFieldExtractor(f, args);\n  } else {\n    return _.always(f);\n  }\n});\n\nvar makeFunction = function (f, args) {\n  return makeFunction_.apply(undefined, [f].concat(args));\n};\n\nvar convertArgsToFunction = function (obs, f, args, method) {\n  if (typeof f !== \"undefined\" && f !== null ? f._isProperty : undefined) {\n    var sampled = f.sampledBy(obs, function (p, s) {\n      return [p, s];\n    });\n    return method.call(sampled, function (_ref) {\n      var p = _ref[0];\n      var s = _ref[1];\n      return p;\n    }).map(function (_ref2) {\n      var p = _ref2[0];\n      var s = _ref2[1];\n      return s;\n    });\n  } else {\n    f = makeFunction(f, args);\n    return method.call(obs, f);\n  }\n};\n\nvar toCombinator = function (f) {\n  if (_.isFunction(f)) {\n    return f;\n  } else if (isFieldKey(f)) {\n    var key = toFieldKey(f);\n    return function (left, right) {\n      return left[key](right);\n    };\n  } else {\n    throw new Exception(\"not a function or a field key: \" + f);\n  }\n};\n\nvar toFieldKey = function (f) {\n  return f.slice(1);\n};\n\nfunction Some(value) {\n  this.value = value;\n}\n\nextend(Some.prototype, {\n  _isSome: true,\n  getOrElse: function () {\n    return this.value;\n  },\n  get: function () {\n    return this.value;\n  },\n  filter: function (f) {\n    if (f(this.value)) {\n      return new Some(this.value);\n    } else {\n      return None;\n    }\n  },\n  map: function (f) {\n    return new Some(f(this.value));\n  },\n  forEach: function (f) {\n    return f(this.value);\n  },\n  isDefined: true,\n  toArray: function () {\n    return [this.value];\n  },\n  inspect: function () {\n    return \"Some(\" + this.value + \")\";\n  },\n  toString: function () {\n    return this.inspect();\n  }\n});\n\nvar None = {\n  _isNone: true,\n  getOrElse: function (value) {\n    return value;\n  },\n  filter: function () {\n    return None;\n  },\n  map: function () {\n    return None;\n  },\n  forEach: function () {},\n  isDefined: false,\n  toArray: function () {\n    return [];\n  },\n  inspect: function () {\n    return \"None\";\n  },\n  toString: function () {\n    return this.inspect();\n  }\n};\n\nvar toOption = function (v) {\n  if ((typeof v !== \"undefined\" && v !== null ? v._isSome : undefined) || (typeof v !== \"undefined\" && v !== null ? v._isNone : undefined)) {\n    return v;\n  } else {\n    return new Some(v);\n  }\n};\n\nBacon.noMore = \"<no-more>\";\nBacon.more = \"<more>\";\n\nvar eventIdCounter = 0;\n\nfunction Event() {\n  this.id = ++eventIdCounter;\n}\n\nEvent.prototype._isEvent = true;\nEvent.prototype.isEvent = function () {\n  return true;\n};\nEvent.prototype.isEnd = function () {\n  return false;\n};\nEvent.prototype.isInitial = function () {\n  return false;\n};\nEvent.prototype.isNext = function () {\n  return false;\n};\nEvent.prototype.isError = function () {\n  return false;\n};\nEvent.prototype.hasValue = function () {\n  return false;\n};\nEvent.prototype.filter = function () {\n  return true;\n};\nEvent.prototype.inspect = function () {\n  return this.toString();\n};\nEvent.prototype.log = function () {\n  return this.toString();\n};\n\nfunction Next(valueF, eager) {\n  if (!(this instanceof Next)) {\n    return new Next(valueF, eager);\n  }\n\n  Event.call(this);\n\n  if (!eager && _.isFunction(valueF) || (valueF != null ? valueF._isNext : void 0)) {\n    this.valueF = valueF;\n    this.valueInternal = void 0;\n  } else {\n    this.valueF = void 0;\n    this.valueInternal = valueF;\n  }\n}\n\ninherit(Next, Event);\n\nNext.prototype.isNext = function () {\n  return true;\n};\nNext.prototype.hasValue = function () {\n  return true;\n};\nNext.prototype.value = function () {\n  var ref;\n  if ((ref = this.valueF) != null ? ref._isNext : void 0) {\n    this.valueInternal = this.valueF.value();\n    this.valueF = void 0;\n  } else if (this.valueF) {\n    this.valueInternal = this.valueF();\n    this.valueF = void 0;\n  }\n  return this.valueInternal;\n};\n\nNext.prototype.fmap = function (f) {\n  var event, value;\n  if (this.valueInternal) {\n    value = this.valueInternal;\n    return this.apply(function () {\n      return f(value);\n    });\n  } else {\n    event = this;\n    return this.apply(function () {\n      return f(event.value());\n    });\n  }\n};\n\nNext.prototype.apply = function (value) {\n  return new Next(value);\n};\nNext.prototype.filter = function (f) {\n  return f(this.value());\n};\nNext.prototype.toString = function () {\n  return _.toString(this.value());\n};\nNext.prototype.log = function () {\n  return this.value();\n};\nNext.prototype._isNext = true;\n\nfunction Initial(valueF, eager) {\n  if (!(this instanceof Initial)) {\n    return new Initial(valueF, eager);\n  }\n  Next.call(this, valueF, eager);\n}\n\ninherit(Initial, Next);\nInitial.prototype._isInitial = true;\nInitial.prototype.isInitial = function () {\n  return true;\n};\nInitial.prototype.isNext = function () {\n  return false;\n};\nInitial.prototype.apply = function (value) {\n  return new Initial(value);\n};\nInitial.prototype.toNext = function () {\n  return new Next(this);\n};\n\nfunction End() {\n  if (!(this instanceof End)) {\n    return new End();\n  }\n  Event.call(this);\n}\n\ninherit(End, Event);\nEnd.prototype.isEnd = function () {\n  return true;\n};\nEnd.prototype.fmap = function () {\n  return this;\n};\nEnd.prototype.apply = function () {\n  return this;\n};\nEnd.prototype.toString = function () {\n  return \"<end>\";\n};\n\nfunction Error(error) {\n  if (!(this instanceof Error)) {\n    return new Error(error);\n  }\n  this.error = error;\n  Event.call(this);\n}\n\ninherit(Error, Event);\nError.prototype.isError = function () {\n  return true;\n};\nError.prototype.fmap = function () {\n  return this;\n};\nError.prototype.apply = function () {\n  return this;\n};\nError.prototype.toString = function () {\n  return \"<error> \" + _.toString(this.error);\n};\n\nBacon.Event = Event;\nBacon.Initial = Initial;\nBacon.Next = Next;\nBacon.End = End;\nBacon.Error = Error;\n\nvar initialEvent = function (value) {\n  return new Initial(value, true);\n};\nvar nextEvent = function (value) {\n  return new Next(value, true);\n};\nvar endEvent = function () {\n  return new End();\n};\nvar toEvent = function (x) {\n  if (x && x._isEvent) {\n    return x;\n  } else {\n    return nextEvent(x);\n  }\n};\n\nvar idCounter = 0;\nvar registerObs = function () {};\n\nfunction Observable(desc) {\n  this.desc = desc;\n  this.id = ++idCounter;\n  this.initialDesc = this.desc;\n}\n\nextend(Observable.prototype, {\n  _isObservable: true,\n\n  subscribe: function (sink) {\n    return UpdateBarrier.wrappedSubscribe(this, sink);\n  },\n\n  subscribeInternal: function (sink) {\n    return this.dispatcher.subscribe(sink);\n  },\n\n  onValue: function () {\n    var f = makeFunctionArgs(arguments);\n    return this.subscribe(function (event) {\n      if (event.hasValue()) {\n        return f(event.value());\n      }\n    });\n  },\n\n  onValues: function (f) {\n    return this.onValue(function (args) {\n      return f.apply(undefined, args);\n    });\n  },\n\n  onError: function () {\n    var f = makeFunctionArgs(arguments);\n    return this.subscribe(function (event) {\n      if (event.isError()) {\n        return f(event.error);\n      }\n    });\n  },\n\n  onEnd: function () {\n    var f = makeFunctionArgs(arguments);\n    return this.subscribe(function (event) {\n      if (event.isEnd()) {\n        return f();\n      }\n    });\n  },\n\n  name: function (name) {\n    this._name = name;\n    return this;\n  },\n\n  withDescription: function () {\n    this.desc = describe.apply(undefined, arguments);\n    return this;\n  },\n\n  toString: function () {\n    if (this._name) {\n      return this._name;\n    } else {\n      return this.desc.toString();\n    }\n  },\n\n  deps: function () {\n    return this.desc.deps();\n  },\n\n  internalDeps: function () {\n    return this.initialDesc.deps();\n  }\n});\n\nObservable.prototype.assign = Observable.prototype.onValue;\nObservable.prototype.forEach = Observable.prototype.onValue;\nObservable.prototype.inspect = Observable.prototype.toString;\n\nBacon.Observable = Observable;\n\nfunction CompositeUnsubscribe() {\n  var ss = arguments.length <= 0 || arguments[0] === undefined ? [] : arguments[0];\n\n  this.unsubscribe = _.bind(this.unsubscribe, this);\n  this.unsubscribed = false;\n  this.subscriptions = [];\n  this.starting = [];\n  for (var i = 0, s; i < ss.length; i++) {\n    s = ss[i];\n    this.add(s);\n  }\n}\n\nextend(CompositeUnsubscribe.prototype, {\n  add: function (subscription) {\n    var _this2 = this;\n\n    if (this.unsubscribed) {\n      return;\n    }\n    var ended = false;\n    var unsub = nop;\n    this.starting.push(subscription);\n    var unsubMe = function () {\n      if (_this2.unsubscribed) {\n        return;\n      }\n      ended = true;\n      _this2.remove(unsub);\n      return _.remove(subscription, _this2.starting);\n    };\n    unsub = subscription(this.unsubscribe, unsubMe);\n    if (!(this.unsubscribed || ended)) {\n      this.subscriptions.push(unsub);\n    } else {\n      unsub();\n    }\n    _.remove(subscription, this.starting);\n    return unsub;\n  },\n\n  remove: function (unsub) {\n    if (this.unsubscribed) {\n      return;\n    }\n    if (_.remove(unsub, this.subscriptions) !== undefined) {\n      return unsub();\n    }\n  },\n\n  unsubscribe: function () {\n    if (this.unsubscribed) {\n      return;\n    }\n    this.unsubscribed = true;\n    var iterable = this.subscriptions;\n    for (var i = 0; i < iterable.length; i++) {\n      iterable[i]();\n    }\n    this.subscriptions = [];\n    this.starting = [];\n    return [];\n  },\n\n  count: function () {\n    if (this.unsubscribed) {\n      return 0;\n    }\n    return this.subscriptions.length + this.starting.length;\n  },\n\n  empty: function () {\n    return this.count() === 0;\n  }\n});\n\nBacon.CompositeUnsubscribe = CompositeUnsubscribe;\n\nfunction Dispatcher(_subscribe, _handleEvent) {\n  this._subscribe = _subscribe;\n  this._handleEvent = _handleEvent;\n  this.subscribe = _.bind(this.subscribe, this);\n  this.handleEvent = _.bind(this.handleEvent, this);\n  this.pushing = false;\n  this.ended = false;\n  this.prevError = undefined;\n  this.unsubSrc = undefined;\n  this.subscriptions = [];\n  this.queue = [];\n}\n\nDispatcher.prototype.hasSubscribers = function () {\n  return this.subscriptions.length > 0;\n};\n\nDispatcher.prototype.removeSub = function (subscription) {\n  this.subscriptions = _.without(subscription, this.subscriptions);\n  return this.subscriptions;\n};\n\nDispatcher.prototype.push = function (event) {\n  if (event.isEnd()) {\n    this.ended = true;\n  }\n  return UpdateBarrier.inTransaction(event, this, this.pushIt, [event]);\n};\n\nDispatcher.prototype.pushToSubscriptions = function (event) {\n  try {\n    var tmp = this.subscriptions;\n    var len = tmp.length;\n    for (var i = 0; i < len; i++) {\n      var sub = tmp[i];\n      var reply = sub.sink(event);\n      if (reply === Bacon.noMore || event.isEnd()) {\n        this.removeSub(sub);\n      }\n    }\n    return true;\n  } catch (error) {\n    this.pushing = false;\n    this.queue = [];\n    throw error;\n  }\n};\n\nDispatcher.prototype.pushIt = function (event) {\n  if (!this.pushing) {\n    if (event === this.prevError) {\n      return;\n    }\n    if (event.isError()) {\n      this.prevError = event;\n    }\n    this.pushing = true;\n    this.pushToSubscriptions(event);\n    this.pushing = false;\n    while (this.queue.length) {\n      event = this.queue.shift();\n      this.push(event);\n    }\n    if (this.hasSubscribers()) {\n      return Bacon.more;\n    } else {\n      this.unsubscribeFromSource();\n      return Bacon.noMore;\n    }\n  } else {\n    this.queue.push(event);\n    return Bacon.more;\n  }\n};\n\nDispatcher.prototype.handleEvent = function (event) {\n  if (this._handleEvent) {\n    return this._handleEvent(event);\n  } else {\n    return this.push(event);\n  }\n};\n\nDispatcher.prototype.unsubscribeFromSource = function () {\n  if (this.unsubSrc) {\n    this.unsubSrc();\n  }\n  this.unsubSrc = undefined;\n};\n\nDispatcher.prototype.subscribe = function (sink) {\n  var subscription;\n  if (this.ended) {\n    sink(endEvent());\n    return nop;\n  } else {\n    assertFunction(sink);\n    subscription = {\n      sink: sink\n    };\n    this.subscriptions.push(subscription);\n    if (this.subscriptions.length === 1) {\n      this.unsubSrc = this._subscribe(this.handleEvent);\n      assertFunction(this.unsubSrc);\n    }\n    return (function (_this) {\n      return function () {\n        _this.removeSub(subscription);\n        if (!_this.hasSubscribers()) {\n          return _this.unsubscribeFromSource();\n        }\n      };\n    })(this);\n  }\n};\n\nBacon.Dispatcher = Dispatcher;\n\nfunction EventStream(desc, subscribe, handler) {\n  if (!(this instanceof EventStream)) {\n    return new EventStream(desc, subscribe, handler);\n  }\n  if (_.isFunction(desc)) {\n    handler = subscribe;\n    subscribe = desc;\n    desc = Desc.empty;\n  }\n  Observable.call(this, desc);\n  assertFunction(subscribe);\n  this.dispatcher = new Dispatcher(subscribe, handler);\n  registerObs(this);\n}\n\ninherit(EventStream, Observable);\nextend(EventStream.prototype, {\n  _isEventStream: true,\n\n  toProperty: function (initValue_) {\n    var initValue = arguments.length === 0 ? None : toOption(function () {\n      return initValue_;\n    });\n    var disp = this.dispatcher;\n    var desc = new Bacon.Desc(this, \"toProperty\", [initValue_]);\n    return new Property(desc, function (sink) {\n      var initSent = false;\n      var subbed = false;\n      var unsub = nop;\n      var reply = Bacon.more;\n      var sendInit = function () {\n        if (!initSent) {\n          return initValue.forEach(function (value) {\n            initSent = true;\n            reply = sink(new Initial(value));\n            if (reply === Bacon.noMore) {\n              unsub();\n              unsub = nop;\n              return nop;\n            }\n          });\n        }\n      };\n\n      unsub = disp.subscribe(function (event) {\n        if (event.hasValue()) {\n          if (event.isInitial() && !subbed) {\n            initValue = new Some(function () {\n              return event.value();\n            });\n            return Bacon.more;\n          } else {\n            if (!event.isInitial()) {\n              sendInit();\n            }\n            initSent = true;\n            initValue = new Some(event);\n            return sink(event);\n          }\n        } else {\n          if (event.isEnd()) {\n            reply = sendInit();\n          }\n          if (reply !== Bacon.noMore) {\n            return sink(event);\n          }\n        }\n      });\n      subbed = true;\n      sendInit();\n      return unsub;\n    });\n  },\n\n  toEventStream: function () {\n    return this;\n  },\n\n  withHandler: function (handler) {\n    return new EventStream(new Bacon.Desc(this, \"withHandler\", [handler]), this.dispatcher.subscribe, handler);\n  }\n});\n\nBacon.EventStream = EventStream;\n\nBacon.never = function () {\n  return new EventStream(describe(Bacon, \"never\"), function (sink) {\n    sink(endEvent());\n    return nop;\n  });\n};\n\nBacon.when = function () {\n  if (arguments.length === 0) {\n    return Bacon.never();\n  }\n  var len = arguments.length;\n  var usage = \"when: expecting arguments in the form (Observable+,function)+\";\n\n  assert(usage, len % 2 === 0);\n  var sources = [];\n  var pats = [];\n  var i = 0;\n  var patterns = [];\n  while (i < len) {\n    patterns[i] = arguments[i];\n    patterns[i + 1] = arguments[i + 1];\n    var patSources = _.toArray(arguments[i]);\n    var f = constantToFunction(arguments[i + 1]);\n    var pat = { f: f, ixs: [] };\n    var triggerFound = false;\n    for (var j = 0, s; j < patSources.length; j++) {\n      s = patSources[j];\n      var index = _.indexOf(sources, s);\n      if (!triggerFound) {\n        triggerFound = Source.isTrigger(s);\n      }\n      if (index < 0) {\n        sources.push(s);\n        index = sources.length - 1;\n      }\n      for (var k = 0, ix; k < pat.ixs.length; k++) {\n        ix = pat.ixs[k];\n        if (ix.index === index) {\n          ix.count++;\n        }\n      }\n      pat.ixs.push({ index: index, count: 1 });\n    }\n\n    assert(\"At least one EventStream required\", triggerFound || !patSources.length);\n\n    if (patSources.length > 0) {\n      pats.push(pat);\n    }\n    i = i + 2;\n  }\n\n  if (!sources.length) {\n    return Bacon.never();\n  }\n\n  sources = _.map(Source.fromObservable, sources);\n  var needsBarrier = _.any(sources, function (s) {\n    return s.flatten;\n  }) && containsDuplicateDeps(_.map(function (s) {\n    return s.obs;\n  }, sources));\n\n  var desc = new Bacon.Desc(Bacon, \"when\", patterns);\n  var resultStream = new EventStream(desc, function (sink) {\n    var triggers = [];\n    var ends = false;\n    var match = function (p) {\n      for (var i1 = 0, i; i1 < p.ixs.length; i1++) {\n        i = p.ixs[i1];\n        if (!sources[i.index].hasAtLeast(i.count)) {\n          return false;\n        }\n      }\n      return true;\n    };\n    var cannotSync = function (source) {\n      return !source.sync || source.ended;\n    };\n    var cannotMatch = function (p) {\n      for (var i1 = 0, i; i1 < p.ixs.length; i1++) {\n        i = p.ixs[i1];\n        if (!sources[i.index].mayHave(i.count)) {\n          return true;\n        }\n      }\n    };\n    var nonFlattened = function (trigger) {\n      return !trigger.source.flatten;\n    };\n    var part = function (source) {\n      return function (unsubAll) {\n        var flushLater = function () {\n          return UpdateBarrier.whenDoneWith(resultStream, flush);\n        };\n        var flushWhileTriggers = function () {\n          if (triggers.length > 0) {\n            var reply = Bacon.more;\n            var trigger = triggers.pop();\n            for (var i1 = 0, p; i1 < pats.length; i1++) {\n              p = pats[i1];\n              if (match(p)) {\n                var events = (function () {\n                  var result = [];\n                  for (var i2 = 0, i; i2 < p.ixs.length; i2++) {\n                    i = p.ixs[i2];\n                    result.push(sources[i.index].consume());\n                  }\n                  return result;\n                })();\n                reply = sink(trigger.e.apply(function () {\n                  var _p;\n\n                  var values = (function () {\n                    var result = [];\n                    for (var i2 = 0, event; i2 < events.length; i2++) {\n                      event = events[i2];\n                      result.push(event.value());\n                    }\n                    return result;\n                  })();\n\n                  return (_p = p).f.apply(_p, values);\n                }));\n                if (triggers.length) {\n                  triggers = _.filter(nonFlattened, triggers);\n                }\n                if (reply === Bacon.noMore) {\n                  return reply;\n                } else {\n                  return flushWhileTriggers();\n                }\n              }\n            }\n          } else {\n            return Bacon.more;\n          }\n        };\n        var flush = function () {\n          var reply = flushWhileTriggers();\n          if (ends) {\n            if (_.all(sources, cannotSync) || _.all(pats, cannotMatch)) {\n              reply = Bacon.noMore;\n              sink(endEvent());\n            }\n          }\n          if (reply === Bacon.noMore) {\n            unsubAll();\n          }\n\n          return reply;\n        };\n        return source.subscribe(function (e) {\n          if (e.isEnd()) {\n            ends = true;\n            source.markEnded();\n            flushLater();\n          } else if (e.isError()) {\n            var reply = sink(e);\n          } else {\n            source.push(e);\n            if (source.sync) {\n              triggers.push({ source: source, e: e });\n              if (needsBarrier || UpdateBarrier.hasWaiters()) {\n                flushLater();\n              } else {\n                flush();\n              }\n            }\n          }\n          if (reply === Bacon.noMore) {\n            unsubAll();\n          }\n          return reply || Bacon.more;\n        });\n      };\n    };\n\n    return new Bacon.CompositeUnsubscribe((function () {\n      var result = [];\n      for (var i1 = 0, s; i1 < sources.length; i1++) {\n        s = sources[i1];\n        result.push(part(s));\n      }\n      return result;\n    })()).unsubscribe;\n  });\n  return resultStream;\n};\n\nvar containsDuplicateDeps = function (observables) {\n  var state = arguments.length <= 1 || arguments[1] === undefined ? [] : arguments[1];\n\n  var checkObservable = function (obs) {\n    if (_.contains(state, obs)) {\n      return true;\n    } else {\n      var deps = obs.internalDeps();\n      if (deps.length) {\n        state.push(obs);\n        return _.any(deps, checkObservable);\n      } else {\n        state.push(obs);\n        return false;\n      }\n    }\n  };\n\n  return _.any(observables, checkObservable);\n};\n\nvar constantToFunction = function (f) {\n  if (_.isFunction(f)) {\n    return f;\n  } else {\n    return _.always(f);\n  }\n};\n\nBacon.groupSimultaneous = function () {\n  for (var _len5 = arguments.length, streams = Array(_len5), _key5 = 0; _key5 < _len5; _key5++) {\n    streams[_key5] = arguments[_key5];\n  }\n\n  if (streams.length === 1 && isArray(streams[0])) {\n    streams = streams[0];\n  }\n  var sources = (function () {\n    var result = [];\n    for (var i = 0, s; i < streams.length; i++) {\n      s = streams[i];\n      result.push(new BufferingSource(s));\n    }\n    return result;\n  })();\n  return withDesc(new Bacon.Desc(Bacon, \"groupSimultaneous\", streams), Bacon.when(sources, function () {\n    for (var _len6 = arguments.length, xs = Array(_len6), _key6 = 0; _key6 < _len6; _key6++) {\n      xs[_key6] = arguments[_key6];\n    }\n\n    return xs;\n  }));\n};\n\nfunction PropertyDispatcher(property, subscribe, handleEvent) {\n  Dispatcher.call(this, subscribe, handleEvent);\n  this.property = property;\n  this.subscribe = _.bind(this.subscribe, this);\n  this.current = None;\n  this.currentValueRootId = undefined;\n  this.propertyEnded = false;\n}\n\ninherit(PropertyDispatcher, Dispatcher);\nextend(PropertyDispatcher.prototype, {\n  push: function (event) {\n    if (event.isEnd()) {\n      this.propertyEnded = true;\n    }\n    if (event.hasValue()) {\n      this.current = new Some(event);\n      this.currentValueRootId = UpdateBarrier.currentEventId();\n    }\n    return Dispatcher.prototype.push.call(this, event);\n  },\n\n  maybeSubSource: function (sink, reply) {\n    if (reply === Bacon.noMore) {\n      return nop;\n    } else if (this.propertyEnded) {\n      sink(endEvent());\n      return nop;\n    } else {\n      return Dispatcher.prototype.subscribe.call(this, sink);\n    }\n  },\n\n  subscribe: function (sink) {\n    var _this3 = this;\n\n    var initSent = false;\n\n    var reply = Bacon.more;\n\n    if (this.current.isDefined && (this.hasSubscribers() || this.propertyEnded)) {\n      var dispatchingId = UpdateBarrier.currentEventId();\n      var valId = this.currentValueRootId;\n      if (!this.propertyEnded && valId && dispatchingId && dispatchingId !== valId) {\n        UpdateBarrier.whenDoneWith(this.property, function () {\n          if (_this3.currentValueRootId === valId) {\n            return sink(initialEvent(_this3.current.get().value()));\n          }\n        });\n\n        return this.maybeSubSource(sink, reply);\n      } else {\n        UpdateBarrier.inTransaction(undefined, this, function () {\n          reply = sink(initialEvent(this.current.get().value()));\n          return reply;\n        }, []);\n        return this.maybeSubSource(sink, reply);\n      }\n    } else {\n      return this.maybeSubSource(sink, reply);\n    }\n  }\n});\n\nfunction Property(desc, subscribe, handler) {\n  Observable.call(this, desc);\n  assertFunction(subscribe);\n  this.dispatcher = new PropertyDispatcher(this, subscribe, handler);\n  registerObs(this);\n}\n\ninherit(Property, Observable);\nextend(Property.prototype, {\n  _isProperty: true,\n\n  changes: function () {\n    var _this4 = this;\n\n    return new EventStream(new Bacon.Desc(this, \"changes\", []), function (sink) {\n      return _this4.dispatcher.subscribe(function (event) {\n        if (!event.isInitial()) {\n          return sink(event);\n        }\n      });\n    });\n  },\n\n  withHandler: function (handler) {\n    return new Property(new Bacon.Desc(this, \"withHandler\", [handler]), this.dispatcher.subscribe, handler);\n  },\n\n  toProperty: function () {\n    assertNoArguments(arguments);\n    return this;\n  },\n\n  toEventStream: function () {\n    var _this5 = this;\n\n    return new EventStream(new Bacon.Desc(this, \"toEventStream\", []), function (sink) {\n      return _this5.dispatcher.subscribe(function (event) {\n        if (event.isInitial()) {\n          event = event.toNext();\n        }\n        return sink(event);\n      });\n    });\n  }\n});\n\nBacon.Property = Property;\n\nBacon.constant = function (value) {\n  return new Property(new Bacon.Desc(Bacon, \"constant\", [value]), function (sink) {\n    sink(initialEvent(value));\n    sink(endEvent());\n    return nop;\n  });\n};\n\nBacon.fromBinder = function (binder) {\n  var eventTransformer = arguments.length <= 1 || arguments[1] === undefined ? _.id : arguments[1];\n\n  var desc = new Bacon.Desc(Bacon, \"fromBinder\", [binder, eventTransformer]);\n  return new EventStream(desc, function (sink) {\n    var unbound = false;\n    var shouldUnbind = false;\n    var unbind = function () {\n      if (!unbound) {\n        if (typeof unbinder !== \"undefined\" && unbinder !== null) {\n          unbinder();\n          return unbound = true;\n        } else {\n          return shouldUnbind = true;\n        }\n      }\n    };\n    var unbinder = binder(function () {\n      var ref;\n\n      for (var _len7 = arguments.length, args = Array(_len7), _key7 = 0; _key7 < _len7; _key7++) {\n        args[_key7] = arguments[_key7];\n      }\n\n      var value = eventTransformer.apply(this, args);\n      if (!(isArray(value) && ((ref = _.last(value)) != null ? ref._isEvent : undefined))) {\n        value = [value];\n      }\n      var reply = Bacon.more;\n      for (var i = 0, event; i < value.length; i++) {\n        event = value[i];\n        reply = sink(event = toEvent(event));\n        if (reply === Bacon.noMore || event.isEnd()) {\n          unbind();\n          return reply;\n        }\n      }\n      return reply;\n    });\n    if (shouldUnbind) {\n      unbind();\n    }\n    return unbind;\n  });\n};\n\nBacon.Observable.prototype.map = function (p) {\n  for (var _len8 = arguments.length, args = Array(_len8 > 1 ? _len8 - 1 : 0), _key8 = 1; _key8 < _len8; _key8++) {\n    args[_key8 - 1] = arguments[_key8];\n  }\n\n  return convertArgsToFunction(this, p, args, function (f) {\n    return withDesc(new Bacon.Desc(this, \"map\", [f]), this.withHandler(function (event) {\n      return this.push(event.fmap(f));\n    }));\n  });\n};\n\nvar argumentsToObservables = function (args) {\n  if (isArray(args[0])) {\n    return args[0];\n  } else {\n    return Array.prototype.slice.call(args);\n  }\n};\n\nvar argumentsToObservablesAndFunction = function (args) {\n  if (_.isFunction(args[0])) {\n    return [argumentsToObservables(Array.prototype.slice.call(args, 1)), args[0]];\n  } else {\n    return [argumentsToObservables(Array.prototype.slice.call(args, 0, args.length - 1)), _.last(args)];\n  }\n};\n\nBacon.combineAsArray = function () {\n  var streams = argumentsToObservables(arguments);\n  if (streams.length) {\n    var sources = [];\n    for (var i = 0; i < streams.length; i++) {\n      var stream = isObservable(streams[i]) ? streams[i] : Bacon.constant(streams[i]);\n      sources.push(new Source(stream, true));\n    }\n    return withDesc(new Bacon.Desc(Bacon, \"combineAsArray\", streams), Bacon.when(sources, function () {\n      for (var _len9 = arguments.length, xs = Array(_len9), _key9 = 0; _key9 < _len9; _key9++) {\n        xs[_key9] = arguments[_key9];\n      }\n\n      return xs;\n    }).toProperty());\n  } else {\n    return Bacon.constant([]);\n  }\n};\n\nBacon.onValues = function () {\n  return Bacon.combineAsArray(Array.prototype.slice.call(arguments, 0, arguments.length - 1)).onValues(arguments[arguments.length - 1]);\n};\n\nBacon.combineWith = function () {\n  var _argumentsToObservablesAndFunction = argumentsToObservablesAndFunction(arguments);\n\n  var streams = _argumentsToObservablesAndFunction[0];\n  var f = _argumentsToObservablesAndFunction[1];\n\n  var desc = new Bacon.Desc(Bacon, \"combineWith\", [f].concat(streams));\n  return withDesc(desc, Bacon.combineAsArray(streams).map(function (values) {\n    return f.apply(undefined, values);\n  }));\n};\n\nBacon.Observable.prototype.combine = function (other, f) {\n  var combinator = toCombinator(f);\n  var desc = new Bacon.Desc(this, \"combine\", [other, f]);\n  return withDesc(desc, Bacon.combineAsArray(this, other).map(function (values) {\n    return combinator(values[0], values[1]);\n  }));\n};\n\nBacon.Observable.prototype.withStateMachine = function (initState, f) {\n  var state = initState;\n  var desc = new Bacon.Desc(this, \"withStateMachine\", [initState, f]);\n  return withDesc(desc, this.withHandler(function (event) {\n    var fromF = f(state, event);\n    var newState = fromF[0];\n    var outputs = fromF[1];\n\n    state = newState;\n    var reply = Bacon.more;\n    for (var i = 0, output; i < outputs.length; i++) {\n      output = outputs[i];\n      reply = this.push(output);\n      if (reply === Bacon.noMore) {\n        return reply;\n      }\n    }\n    return reply;\n  }));\n};\n\nvar equals = function (a, b) {\n  return a === b;\n};\n\nvar isNone = function (object) {\n  return typeof object !== \"undefined\" && object !== null ? object._isNone : false;\n};\n\nBacon.Observable.prototype.skipDuplicates = function () {\n  var isEqual = arguments.length <= 0 || arguments[0] === undefined ? equals : arguments[0];\n\n  var desc = new Bacon.Desc(this, \"skipDuplicates\", []);\n  return withDesc(desc, this.withStateMachine(None, function (prev, event) {\n    if (!event.hasValue()) {\n      return [prev, [event]];\n    } else if (event.isInitial() || isNone(prev) || !isEqual(prev.get(), event.value())) {\n      return [new Some(event.value()), [event]];\n    } else {\n      return [prev, []];\n    }\n  }));\n};\n\nBacon.Observable.prototype.awaiting = function (other) {\n  var desc = new Bacon.Desc(this, \"awaiting\", [other]);\n  return withDesc(desc, Bacon.groupSimultaneous(this, other).map(function (values) {\n    return values[1].length === 0;\n  }).toProperty(false).skipDuplicates());\n};\n\nBacon.Observable.prototype.not = function () {\n  return withDesc(new Bacon.Desc(this, \"not\", []), this.map(function (x) {\n    return !x;\n  }));\n};\n\nBacon.Property.prototype.and = function (other) {\n  return withDesc(new Bacon.Desc(this, \"and\", [other]), this.combine(other, function (x, y) {\n    return x && y;\n  }));\n};\n\nBacon.Property.prototype.or = function (other) {\n  return withDesc(new Bacon.Desc(this, \"or\", [other]), this.combine(other, function (x, y) {\n    return x || y;\n  }));\n};\n\nBacon.scheduler = {\n  setTimeout: function (f, d) {\n    return setTimeout(f, d);\n  },\n  setInterval: function (f, i) {\n    return setInterval(f, i);\n  },\n  clearInterval: function (id) {\n    return clearInterval(id);\n  },\n  clearTimeout: function (id) {\n    return clearTimeout(id);\n  },\n  now: function () {\n    return new Date().getTime();\n  }\n};\n\nBacon.EventStream.prototype.bufferWithTime = function (delay) {\n  return withDesc(new Bacon.Desc(this, \"bufferWithTime\", [delay]), this.bufferWithTimeOrCount(delay, Number.MAX_VALUE));\n};\n\nBacon.EventStream.prototype.bufferWithCount = function (count) {\n  return withDesc(new Bacon.Desc(this, \"bufferWithCount\", [count]), this.bufferWithTimeOrCount(undefined, count));\n};\n\nBacon.EventStream.prototype.bufferWithTimeOrCount = function (delay, count) {\n  var flushOrSchedule = function (buffer) {\n    if (buffer.values.length === count) {\n      return buffer.flush();\n    } else if (delay !== undefined) {\n      return buffer.schedule();\n    }\n  };\n  var desc = new Bacon.Desc(this, \"bufferWithTimeOrCount\", [delay, count]);\n  return withDesc(desc, this.buffer(delay, flushOrSchedule, flushOrSchedule));\n};\n\nBacon.EventStream.prototype.buffer = function (delay) {\n  var onInput = arguments.length <= 1 || arguments[1] === undefined ? nop : arguments[1];\n  var onFlush = arguments.length <= 2 || arguments[2] === undefined ? nop : arguments[2];\n\n  var buffer = {\n    scheduled: null,\n    end: undefined,\n    values: [],\n    flush: function () {\n      if (this.scheduled) {\n        Bacon.scheduler.clearTimeout(this.scheduled);\n        this.scheduled = null;\n      }\n      if (this.values.length > 0) {\n        var valuesToPush = this.values;\n        this.values = [];\n        var reply = this.push(nextEvent(valuesToPush));\n        if (this.end != null) {\n          return this.push(this.end);\n        } else if (reply !== Bacon.noMore) {\n          return onFlush(this);\n        }\n      } else {\n        if (this.end != null) {\n          return this.push(this.end);\n        }\n      }\n    },\n    schedule: function () {\n      var _this6 = this;\n\n      if (!this.scheduled) {\n        return this.scheduled = delay(function () {\n          return _this6.flush();\n        });\n      }\n    }\n  };\n  var reply = Bacon.more;\n  if (!_.isFunction(delay)) {\n    var delayMs = delay;\n    delay = function (f) {\n      return Bacon.scheduler.setTimeout(f, delayMs);\n    };\n  }\n  return withDesc(new Bacon.Desc(this, \"buffer\", []), this.withHandler(function (event) {\n    var _this7 = this;\n\n    buffer.push = function (event) {\n      return _this7.push(event);\n    };\n    if (event.isError()) {\n      reply = this.push(event);\n    } else if (event.isEnd()) {\n      buffer.end = event;\n      if (!buffer.scheduled) {\n        buffer.flush();\n      }\n    } else {\n      buffer.values.push(event.value());\n\n      onInput(buffer);\n    }\n    return reply;\n  }));\n};\n\nBacon.Observable.prototype.filter = function (f) {\n  assertObservableIsProperty(f);\n\n  for (var _len10 = arguments.length, args = Array(_len10 > 1 ? _len10 - 1 : 0), _key10 = 1; _key10 < _len10; _key10++) {\n    args[_key10 - 1] = arguments[_key10];\n  }\n\n  return convertArgsToFunction(this, f, args, function (f) {\n    return withDesc(new Bacon.Desc(this, \"filter\", [f]), this.withHandler(function (event) {\n      if (event.filter(f)) {\n        return this.push(event);\n      } else {\n        return Bacon.more;\n      }\n    }));\n  });\n};\n\nBacon.once = function (value) {\n  return new EventStream(new Desc(Bacon, \"once\", [value]), function (sink) {\n    sink(toEvent(value));\n    sink(endEvent());\n    return nop;\n  });\n};\n\nfunction addPropertyInitValueToStream(property, stream) {\n  var justInitValue = new EventStream(describe(property, \"justInitValue\"), function (sink) {\n    var value = undefined;\n    var unsub = property.dispatcher.subscribe(function (event) {\n      if (!event.isEnd()) {\n        value = event;\n      }\n      return Bacon.noMore;\n    });\n    UpdateBarrier.whenDoneWith(justInitValue, function () {\n      if (typeof value !== \"undefined\" && value !== null) {\n        sink(value);\n      }\n      return sink(endEvent());\n    });\n    return unsub;\n  });\n  return justInitValue.concat(stream).toProperty();\n}\n\nBacon.EventStream.prototype.concat = function (right) {\n  var left = this;\n  return new EventStream(new Bacon.Desc(left, \"concat\", [right]), function (sink) {\n    var unsubRight = nop;\n    var unsubLeft = left.dispatcher.subscribe(function (e) {\n      if (e.isEnd()) {\n        unsubRight = right.toEventStream().dispatcher.subscribe(sink);\n        return unsubRight;\n      } else {\n        return sink(e);\n      }\n    });\n    return function () {\n      return unsubLeft(), unsubRight();\n    };\n  });\n};\n\nBacon.Property.prototype.concat = function (right) {\n  return addPropertyInitValueToStream(this, this.changes().concat(right));\n};\n\nBacon.concatAll = function () {\n  var streams = argumentsToObservables(arguments);\n  if (streams.length) {\n    return withDesc(new Bacon.Desc(Bacon, \"concatAll\", streams), _.fold(_.tail(streams), _.head(streams).toEventStream(), function (a, b) {\n      return a.concat(b);\n    }));\n  } else {\n    return Bacon.never();\n  }\n};\n\nBacon.Observable.prototype.flatMap = function () {\n  return flatMap_(this, makeSpawner(arguments));\n};\n\nBacon.Observable.prototype.flatMapFirst = function () {\n  return flatMap_(this, makeSpawner(arguments), true);\n};\n\nvar makeSpawner = function (args) {\n  if (args.length === 1 && isObservable(args[0])) {\n    return _.always(args[0]);\n  } else {\n    return makeFunctionArgs(args);\n  }\n};\n\nvar makeObservable = function (x) {\n  if (isObservable(x)) {\n    return x;\n  } else {\n    return Bacon.once(x);\n  }\n};\n\nvar flatMap_ = function (root, f, firstOnly, limit) {\n  var rootDep = [root];\n  var childDeps = [];\n  var desc = new Bacon.Desc(root, \"flatMap\" + (firstOnly ? \"First\" : \"\"), [f]);\n  var result = new EventStream(desc, function (sink) {\n    var composite = new CompositeUnsubscribe();\n    var queue = [];\n    var spawn = function (event) {\n      var child = makeObservable(f(event.value()));\n      childDeps.push(child);\n      return composite.add(function (unsubAll, unsubMe) {\n        return child.dispatcher.subscribe(function (event) {\n          if (event.isEnd()) {\n            _.remove(child, childDeps);\n            checkQueue();\n            checkEnd(unsubMe);\n            return Bacon.noMore;\n          } else {\n            if (typeof event !== \"undefined\" && event !== null ? event._isInitial : undefined) {\n              event = event.toNext();\n            }\n            var reply = sink(event);\n            if (reply === Bacon.noMore) {\n              unsubAll();\n            }\n            return reply;\n          }\n        });\n      });\n    };\n    var checkQueue = function () {\n      var event = queue.shift();\n      if (event) {\n        return spawn(event);\n      }\n    };\n    var checkEnd = function (unsub) {\n      unsub();\n      if (composite.empty()) {\n        return sink(endEvent());\n      }\n    };\n    composite.add(function (__, unsubRoot) {\n      return root.dispatcher.subscribe(function (event) {\n        if (event.isEnd()) {\n          return checkEnd(unsubRoot);\n        } else if (event.isError()) {\n          return sink(event);\n        } else if (firstOnly && composite.count() > 1) {\n          return Bacon.more;\n        } else {\n          if (composite.unsubscribed) {\n            return Bacon.noMore;\n          }\n          if (limit && composite.count() > limit) {\n            return queue.push(event);\n          } else {\n            return spawn(event);\n          }\n        }\n      });\n    });\n    return composite.unsubscribe;\n  });\n  result.internalDeps = function () {\n    if (childDeps.length) {\n      return rootDep.concat(childDeps);\n    } else {\n      return rootDep;\n    }\n  };\n  return result;\n};\n\nBacon.Observable.prototype.flatMapWithConcurrencyLimit = function (limit) {\n  for (var _len11 = arguments.length, args = Array(_len11 > 1 ? _len11 - 1 : 0), _key11 = 1; _key11 < _len11; _key11++) {\n    args[_key11 - 1] = arguments[_key11];\n  }\n\n  var desc = new Bacon.Desc(this, \"flatMapWithConcurrencyLimit\", [limit].concat(args));\n  return withDesc(desc, flatMap_(this, makeSpawner(args), false, limit));\n};\n\nBacon.Observable.prototype.flatMapConcat = function () {\n  var desc = new Bacon.Desc(this, \"flatMapConcat\", Array.prototype.slice.call(arguments, 0));\n  return withDesc(desc, this.flatMapWithConcurrencyLimit.apply(this, [1].concat(_slice.call(arguments))));\n};\n\nBacon.later = function (delay, value) {\n  return withDesc(new Bacon.Desc(Bacon, \"later\", [delay, value]), Bacon.fromBinder(function (sink) {\n    var sender = function () {\n      return sink([value, endEvent()]);\n    };\n    var id = Bacon.scheduler.setTimeout(sender, delay);\n    return function () {\n      return Bacon.scheduler.clearTimeout(id);\n    };\n  }));\n};\n\nBacon.Observable.prototype.bufferingThrottle = function (minimumInterval) {\n  var desc = new Bacon.Desc(this, \"bufferingThrottle\", [minimumInterval]);\n  return withDesc(desc, this.flatMapConcat(function (x) {\n    return Bacon.once(x).concat(Bacon.later(minimumInterval).filter(false));\n  }));\n};\n\nBacon.Property.prototype.bufferingThrottle = function () {\n  return Bacon.Observable.prototype.bufferingThrottle.apply(this, arguments).toProperty();\n};\n\nfunction Bus() {\n  if (!(this instanceof Bus)) {\n    return new Bus();\n  }\n\n  this.unsubAll = _.bind(this.unsubAll, this);\n  this.subscribeAll = _.bind(this.subscribeAll, this);\n  this.guardedSink = _.bind(this.guardedSink, this);\n\n  this.sink = undefined;\n  this.subscriptions = [];\n  this.ended = false;\n  EventStream.call(this, new Bacon.Desc(Bacon, \"Bus\", []), this.subscribeAll);\n}\n\ninherit(Bus, EventStream);\nextend(Bus.prototype, {\n  unsubAll: function () {\n    var iterable = this.subscriptions;\n    for (var i = 0, sub; i < iterable.length; i++) {\n      sub = iterable[i];\n      if (typeof sub.unsub === \"function\") {\n        sub.unsub();\n      }\n    }\n  },\n\n  subscribeAll: function (newSink) {\n    if (this.ended) {\n      newSink(endEvent());\n    } else {\n      this.sink = newSink;\n      var iterable = cloneArray(this.subscriptions);\n      for (var i = 0, subscription; i < iterable.length; i++) {\n        subscription = iterable[i];\n        this.subscribeInput(subscription);\n      }\n    }\n    return this.unsubAll;\n  },\n\n  guardedSink: function (input) {\n    var _this8 = this;\n\n    return function (event) {\n      if (event.isEnd()) {\n        _this8.unsubscribeInput(input);\n        return Bacon.noMore;\n      } else {\n        return _this8.sink(event);\n      }\n    };\n  },\n\n  subscribeInput: function (subscription) {\n    subscription.unsub = subscription.input.dispatcher.subscribe(this.guardedSink(subscription.input));\n    return subscription.unsub;\n  },\n\n  unsubscribeInput: function (input) {\n    var iterable = this.subscriptions;\n    for (var i = 0, sub; i < iterable.length; i++) {\n      sub = iterable[i];\n      if (sub.input === input) {\n        if (typeof sub.unsub === \"function\") {\n          sub.unsub();\n        }\n        this.subscriptions.splice(i, 1);\n        return;\n      }\n    }\n  },\n\n  plug: function (input) {\n    var _this9 = this;\n\n    assertObservable(input);\n    if (this.ended) {\n      return;\n    }\n    var sub = { input: input };\n    this.subscriptions.push(sub);\n    if (typeof this.sink !== \"undefined\") {\n      this.subscribeInput(sub);\n    }\n    return function () {\n      return _this9.unsubscribeInput(input);\n    };\n  },\n\n  end: function () {\n    this.ended = true;\n    this.unsubAll();\n    if (typeof this.sink === \"function\") {\n      return this.sink(endEvent());\n    }\n  },\n\n  push: function (value) {\n    if (!this.ended && typeof this.sink === \"function\") {\n      var rootPush = !this.pushing;\n      if (!rootPush) {\n        if (!this.pushQueue) this.pushQueue = [];\n        this.pushQueue.push(value);\n\n        return;\n      }\n      this.pushing = true;\n      try {\n        return this.sink(nextEvent(value));\n      } finally {\n        if (rootPush && this.pushQueue) {\n          var i = 0;\n          while (i < this.pushQueue.length) {\n            var value = this.pushQueue[i];\n            this.sink(nextEvent(value));\n            i++;\n          }\n          this.pushQueue = null;\n        }\n        this.pushing = false;\n      }\n    }\n  },\n\n  error: function (error) {\n    if (typeof this.sink === \"function\") {\n      return this.sink(new Error(error));\n    }\n  }\n});\n\nBacon.Bus = Bus;\n\nvar liftCallback = function (desc, wrapped) {\n  return withMethodCallSupport(function (f) {\n    var stream = partiallyApplied(wrapped, [function (values, callback) {\n      return f.apply(undefined, values.concat([callback]));\n    }]);\n\n    for (var _len12 = arguments.length, args = Array(_len12 > 1 ? _len12 - 1 : 0), _key12 = 1; _key12 < _len12; _key12++) {\n      args[_key12 - 1] = arguments[_key12];\n    }\n\n    return withDesc(new Bacon.Desc(Bacon, desc, [f].concat(args)), Bacon.combineAsArray(args).flatMap(stream));\n  });\n};\n\nBacon.fromCallback = liftCallback(\"fromCallback\", function (f) {\n  for (var _len13 = arguments.length, args = Array(_len13 > 1 ? _len13 - 1 : 0), _key13 = 1; _key13 < _len13; _key13++) {\n    args[_key13 - 1] = arguments[_key13];\n  }\n\n  return Bacon.fromBinder(function (handler) {\n    makeFunction(f, args)(handler);\n    return nop;\n  }, function (value) {\n    return [value, endEvent()];\n  });\n});\n\nBacon.fromNodeCallback = liftCallback(\"fromNodeCallback\", function (f) {\n  for (var _len14 = arguments.length, args = Array(_len14 > 1 ? _len14 - 1 : 0), _key14 = 1; _key14 < _len14; _key14++) {\n    args[_key14 - 1] = arguments[_key14];\n  }\n\n  return Bacon.fromBinder(function (handler) {\n    makeFunction(f, args)(handler);\n    return nop;\n  }, function (error, value) {\n    if (error) {\n      return [new Error(error), endEvent()];\n    }\n    return [value, endEvent()];\n  });\n});\n\nBacon.combineTemplate = function (template) {\n  function current(ctxStack) {\n    return ctxStack[ctxStack.length - 1];\n  }\n  function setValue(ctxStack, key, value) {\n    current(ctxStack)[key] = value;\n    return value;\n  }\n  function applyStreamValue(key, index) {\n    return function (ctxStack, values) {\n      setValue(ctxStack, key, values[index]);\n    };\n  }\n  function constantValue(key, value) {\n    return function (ctxStack) {\n      setValue(ctxStack, key, value);\n    };\n  }\n\n  function mkContext(template) {\n    return isArray(template) ? [] : {};\n  }\n\n  function pushContext(key, value) {\n    return function (ctxStack) {\n      var newContext = mkContext(value);\n      setValue(ctxStack, key, newContext);\n      ctxStack.push(newContext);\n    };\n  }\n\n  function containsObservables(value) {\n    if (isObservable(value)) {\n      return true;\n    } else if (value && (value.constructor == Object || value.constructor == Array)) {\n      for (var key in value) {\n        if (Object.prototype.hasOwnProperty.call(value, key)) {\n          var child = value[key];\n          if (containsObservables(child)) return true;\n        }\n      }\n    }\n  }\n\n  function compile(key, value) {\n    if (isObservable(value)) {\n      streams.push(value);\n      funcs.push(applyStreamValue(key, streams.length - 1));\n    } else if (containsObservables(value)) {\n      var popContext = function (ctxStack) {\n        ctxStack.pop();\n      };\n      funcs.push(pushContext(key, value));\n      compileTemplate(value);\n      funcs.push(popContext);\n    } else {\n      funcs.push(constantValue(key, value));\n    }\n  }\n\n  function combinator(values) {\n    var rootContext = mkContext(template);\n    var ctxStack = [rootContext];\n    for (var i = 0, f; i < funcs.length; i++) {\n      f = funcs[i];\n      f(ctxStack, values);\n    }\n    return rootContext;\n  }\n\n  function compileTemplate(template) {\n    _.each(template, compile);\n  }\n\n  var funcs = [];\n  var streams = [];\n\n  var resultProperty = containsObservables(template) ? (compileTemplate(template), Bacon.combineAsArray(streams).map(combinator)) : Bacon.constant(template);\n\n  return withDesc(new Bacon.Desc(Bacon, \"combineTemplate\", [template]), resultProperty);\n};\n\nBacon.Observable.prototype.mapEnd = function () {\n  var f = makeFunctionArgs(arguments);\n  return withDesc(new Bacon.Desc(this, \"mapEnd\", [f]), this.withHandler(function (event) {\n    if (event.isEnd()) {\n      this.push(nextEvent(f(event)));\n      this.push(endEvent());\n      return Bacon.noMore;\n    } else {\n      return this.push(event);\n    }\n  }));\n};\n\nBacon.Observable.prototype.skipErrors = function () {\n  return withDesc(new Bacon.Desc(this, \"skipErrors\", []), this.withHandler(function (event) {\n    if (event.isError()) {\n      return Bacon.more;\n    } else {\n      return this.push(event);\n    }\n  }));\n};\n\nBacon.Observable.prototype.takeUntil = function (stopper) {\n  var endMarker = {};\n  var withEndMarker = Bacon.groupSimultaneous(this.mapEnd(endMarker), stopper.skipErrors());\n  if (this instanceof Property) withEndMarker = withEndMarker.toProperty();\n  var impl = withEndMarker.withHandler(function (event) {\n    if (!event.hasValue()) {\n      return this.push(event);\n    } else {\n      var _event$value = event.value();\n\n      var data = _event$value[0];\n      var stopper = _event$value[1];\n\n      if (stopper.length) {\n        return this.push(endEvent());\n      } else {\n        var reply = Bacon.more;\n        for (var i = 0, value; i < data.length; i++) {\n          value = data[i];\n          if (value === endMarker) {\n            reply = this.push(endEvent());\n          } else {\n            reply = this.push(nextEvent(value));\n          }\n        }\n        return reply;\n      }\n    }\n  });\n  return withDesc(new Bacon.Desc(this, \"takeUntil\", [stopper]), impl);\n};\n\nBacon.Observable.prototype.flatMapLatest = function () {\n  var f = makeSpawner(arguments);\n  var stream = this.toEventStream();\n  return withDesc(new Bacon.Desc(this, \"flatMapLatest\", [f]), stream.flatMap(function (value) {\n    return makeObservable(f(value)).takeUntil(stream);\n  }));\n};\n\nBacon.Property.prototype.delayChanges = function (desc, f) {\n  return withDesc(desc, addPropertyInitValueToStream(this, f(this.changes())));\n};\n\nBacon.EventStream.prototype.delayChanges = function (desc, f) {\n  return withDesc(desc, f(this));\n};\n\nBacon.Observable.prototype.delay = function (delay) {\n  return this.delayChanges(new Bacon.Desc(this, \"delay\", [delay]), function (changes) {\n    return changes.flatMap(function (value) {\n      return Bacon.later(delay, value);\n    });\n  });\n};\n\nBacon.Observable.prototype.debounce = function (delay) {\n  return this.delayChanges(new Bacon.Desc(this, \"debounce\", [delay]), function (changes) {\n    return changes.flatMapLatest(function (value) {\n      return Bacon.later(delay, value);\n    });\n  });\n};\n\nBacon.Observable.prototype.debounceImmediate = function (delay) {\n  return this.delayChanges(new Bacon.Desc(this, \"debounceImmediate\", [delay]), function (changes) {\n    return changes.flatMapFirst(function (value) {\n      return Bacon.once(value).concat(Bacon.later(delay).filter(false));\n    });\n  });\n};\n\nBacon.Observable.prototype.decode = function (cases) {\n  return withDesc(new Bacon.Desc(this, \"decode\", [cases]), this.combine(Bacon.combineTemplate(cases), function (key, values) {\n    return values[key];\n  }));\n};\n\nBacon.Observable.prototype.scan = function (seed, f) {\n  var _this10 = this;\n\n  var resultProperty;\n  f = toCombinator(f);\n  var acc = toOption(seed);\n  var initHandled = false;\n  var subscribe = function (sink) {\n    var initSent = false;\n    var unsub = nop;\n    var reply = Bacon.more;\n    var sendInit = function () {\n      if (!initSent) {\n        return acc.forEach(function (value) {\n          initSent = initHandled = true;\n          reply = sink(new Initial(function () {\n            return value;\n          }));\n          if (reply === Bacon.noMore) {\n            unsub();\n            unsub = nop;\n            return unsub;\n          }\n        });\n      }\n    };\n    unsub = _this10.dispatcher.subscribe(function (event) {\n      if (event.hasValue()) {\n        if (initHandled && event.isInitial()) {\n          return Bacon.more;\n        } else {\n            if (!event.isInitial()) {\n              sendInit();\n            }\n            initSent = initHandled = true;\n            var prev = acc.getOrElse(undefined);\n            var next = f(prev, event.value());\n\n            acc = new Some(next);\n            return sink(event.apply(function () {\n              return next;\n            }));\n          }\n      } else {\n        if (event.isEnd()) {\n          reply = sendInit();\n        }\n        if (reply !== Bacon.noMore) {\n          return sink(event);\n        }\n      }\n    });\n    UpdateBarrier.whenDoneWith(resultProperty, sendInit);\n    return unsub;\n  };\n  resultProperty = new Property(new Bacon.Desc(this, \"scan\", [seed, f]), subscribe);\n  return resultProperty;\n};\n\nBacon.Observable.prototype.diff = function (start, f) {\n  f = toCombinator(f);\n  return withDesc(new Bacon.Desc(this, \"diff\", [start, f]), this.scan([start], function (prevTuple, next) {\n    return [next, f(prevTuple[0], next)];\n  }).filter(function (tuple) {\n    return tuple.length === 2;\n  }).map(function (tuple) {\n    return tuple[1];\n  }));\n};\n\nBacon.Observable.prototype.doAction = function () {\n  var f = makeFunctionArgs(arguments);\n  return withDesc(new Bacon.Desc(this, \"doAction\", [f]), this.withHandler(function (event) {\n    if (event.hasValue()) {\n      f(event.value());\n    }\n    return this.push(event);\n  }));\n};\n\nBacon.Observable.prototype.doEnd = function () {\n  var f = makeFunctionArgs(arguments);\n  return withDesc(new Bacon.Desc(this, \"doEnd\", [f]), this.withHandler(function (event) {\n    if (event.isEnd()) {\n      f();\n    }\n    return this.push(event);\n  }));\n};\n\nBacon.Observable.prototype.doError = function () {\n  var f = makeFunctionArgs(arguments);\n  return withDesc(new Bacon.Desc(this, \"doError\", [f]), this.withHandler(function (event) {\n    if (event.isError()) {\n      f(event.error);\n    }\n    return this.push(event);\n  }));\n};\n\nBacon.Observable.prototype.doLog = function () {\n  for (var _len15 = arguments.length, args = Array(_len15), _key15 = 0; _key15 < _len15; _key15++) {\n    args[_key15] = arguments[_key15];\n  }\n\n  return withDesc(new Bacon.Desc(this, \"doLog\", args), this.withHandler(function (event) {\n    if (typeof console !== \"undefined\" && console !== null && typeof console.log === \"function\") {\n      console.log.apply(console, args.concat([event.log()]));\n    }\n    return this.push(event);\n  }));\n};\n\nBacon.Observable.prototype.endOnError = function (f) {\n  if (!(typeof f !== \"undefined\" && f !== null)) {\n    f = true;\n  }\n\n  for (var _len16 = arguments.length, args = Array(_len16 > 1 ? _len16 - 1 : 0), _key16 = 1; _key16 < _len16; _key16++) {\n    args[_key16 - 1] = arguments[_key16];\n  }\n\n  return convertArgsToFunction(this, f, args, function (f) {\n    return withDesc(new Bacon.Desc(this, \"endOnError\", []), this.withHandler(function (event) {\n      if (event.isError() && f(event.error)) {\n        this.push(event);\n        return this.push(endEvent());\n      } else {\n        return this.push(event);\n      }\n    }));\n  });\n};\n\nObservable.prototype.errors = function () {\n  return withDesc(new Bacon.Desc(this, \"errors\", []), this.filter(function () {\n    return false;\n  }));\n};\n\nBacon.Observable.prototype.take = function (count) {\n  if (count <= 0) {\n    return Bacon.never();\n  }\n  return withDesc(new Bacon.Desc(this, \"take\", [count]), this.withHandler(function (event) {\n    if (!event.hasValue()) {\n      return this.push(event);\n    } else {\n      count--;\n      if (count > 0) {\n        return this.push(event);\n      } else {\n        if (count === 0) {\n          this.push(event);\n        }\n        this.push(endEvent());\n        return Bacon.noMore;\n      }\n    }\n  }));\n};\n\nBacon.Observable.prototype.first = function () {\n  return withDesc(new Bacon.Desc(this, \"first\", []), this.take(1));\n};\n\nBacon.Observable.prototype.mapError = function () {\n  var f = makeFunctionArgs(arguments);\n  return withDesc(new Bacon.Desc(this, \"mapError\", [f]), this.withHandler(function (event) {\n    if (event.isError()) {\n      return this.push(nextEvent(f(event.error)));\n    } else {\n      return this.push(event);\n    }\n  }));\n};\n\nBacon.Observable.prototype.flatMapError = function (fn) {\n  var desc = new Bacon.Desc(this, \"flatMapError\", [fn]);\n  return withDesc(desc, this.mapError(function (err) {\n    return new Error(err);\n  }).flatMap(function (x) {\n    if (x instanceof Error) {\n      return fn(x.error);\n    } else {\n      return Bacon.once(x);\n    }\n  }));\n};\n\nBacon.EventStream.prototype.flatScan = function (seed, f) {\n  var current = seed;\n  return this.flatMapConcat(function (next) {\n    return makeObservable(f(current, next)).doAction(function (updated) {\n      return current = updated;\n    });\n  }).toProperty(seed);\n};\n\nBacon.EventStream.prototype.sampledBy = function (sampler, combinator) {\n  return withDesc(new Bacon.Desc(this, \"sampledBy\", [sampler, combinator]), this.toProperty().sampledBy(sampler, combinator));\n};\n\nBacon.Property.prototype.sampledBy = function (sampler, combinator) {\n  var lazy = false;\n  if (typeof combinator !== \"undefined\" && combinator !== null) {\n    combinator = toCombinator(combinator);\n  } else {\n    lazy = true;\n    combinator = function (f) {\n      return f.value();\n    };\n  }\n  var thisSource = new Source(this, false, lazy);\n  var samplerSource = new Source(sampler, true, lazy);\n  var stream = Bacon.when([thisSource, samplerSource], combinator);\n  var result = sampler._isProperty ? stream.toProperty() : stream;\n  return withDesc(new Bacon.Desc(this, \"sampledBy\", [sampler, combinator]), result);\n};\n\nBacon.Property.prototype.sample = function (interval) {\n  return withDesc(new Bacon.Desc(this, \"sample\", [interval]), this.sampledBy(Bacon.interval(interval, {})));\n};\n\nBacon.Observable.prototype.map = function (p) {\n  if (p && p._isProperty) {\n    return p.sampledBy(this, former);\n  } else {\n    for (var _len17 = arguments.length, args = Array(_len17 > 1 ? _len17 - 1 : 0), _key17 = 1; _key17 < _len17; _key17++) {\n      args[_key17 - 1] = arguments[_key17];\n    }\n\n    return convertArgsToFunction(this, p, args, function (f) {\n      return withDesc(new Bacon.Desc(this, \"map\", [f]), this.withHandler(function (event) {\n        return this.push(event.fmap(f));\n      }));\n    });\n  }\n};\n\nBacon.Observable.prototype.fold = function (seed, f) {\n  return withDesc(new Bacon.Desc(this, \"fold\", [seed, f]), this.scan(seed, f).sampledBy(this.filter(false).mapEnd().toProperty()));\n};\n\nObservable.prototype.reduce = Observable.prototype.fold;\n\nvar eventMethods = [[\"addEventListener\", \"removeEventListener\"], [\"addListener\", \"removeListener\"], [\"on\", \"off\"], [\"bind\", \"unbind\"]];\n\nvar findHandlerMethods = function (target) {\n  var pair;\n  for (var i = 0; i < eventMethods.length; i++) {\n    pair = eventMethods[i];\n    var methodPair = [target[pair[0]], target[pair[1]]];\n    if (methodPair[0] && methodPair[1]) {\n      return methodPair;\n    }\n  }\n  for (var j = 0; j < eventMethods.length; j++) {\n    pair = eventMethods[j];\n    var addListener = target[pair[0]];\n    if (addListener) {\n      return [addListener, function () {}];\n    }\n  }\n  throw new Error(\"No suitable event methods in \" + target);\n};\n\nBacon.fromEventTarget = function (target, eventName, eventTransformer) {\n  var _findHandlerMethods = findHandlerMethods(target);\n\n  var sub = _findHandlerMethods[0];\n  var unsub = _findHandlerMethods[1];\n\n  var desc = new Bacon.Desc(Bacon, \"fromEvent\", [target, eventName]);\n  return withDesc(desc, Bacon.fromBinder(function (handler) {\n    sub.call(target, eventName, handler);\n    return function () {\n      return unsub.call(target, eventName, handler);\n    };\n  }, eventTransformer));\n};\n\nBacon.fromEvent = Bacon.fromEventTarget;\n\nBacon.fromPoll = function (delay, poll) {\n  var desc = new Bacon.Desc(Bacon, \"fromPoll\", [delay, poll]);\n  return withDesc(desc, Bacon.fromBinder(function (handler) {\n    var id = Bacon.scheduler.setInterval(handler, delay);\n    return function () {\n      return Bacon.scheduler.clearInterval(id);\n    };\n  }, poll));\n};\n\nfunction valueAndEnd(value) {\n  return [value, endEvent()];\n}\n\nBacon.fromPromise = function (promise, abort) {\n  var eventTransformer = arguments.length <= 2 || arguments[2] === undefined ? valueAndEnd : arguments[2];\n\n  return withDesc(new Bacon.Desc(Bacon, \"fromPromise\", [promise]), Bacon.fromBinder(function (handler) {\n    var bound = promise.then(handler, function (e) {\n      return handler(new Error(e));\n    });\n    if (bound && typeof bound.done === \"function\") {\n      bound.done();\n    }\n\n    if (abort) {\n      return function () {\n        if (typeof promise.abort === \"function\") {\n          return promise.abort();\n        }\n      };\n    } else {\n      return function () {};\n    }\n  }, eventTransformer));\n};\n\nBacon.Observable.prototype.groupBy = function (keyF) {\n  var limitF = arguments.length <= 1 || arguments[1] === undefined ? Bacon._.id : arguments[1];\n\n  var streams = {};\n  var src = this;\n  return src.filter(function (x) {\n    return !streams[keyF(x)];\n  }).map(function (x) {\n    var key = keyF(x);\n    var similar = src.filter(function (x) {\n      return keyF(x) === key;\n    });\n    var data = Bacon.once(x).concat(similar);\n    var limited = limitF(data, x).withHandler(function (event) {\n      this.push(event);\n      if (event.isEnd()) {\n        return delete streams[key];\n      }\n    });\n    streams[key] = limited;\n    return limited;\n  });\n};\n\nBacon.fromArray = function (values) {\n  assertArray(values);\n  if (!values.length) {\n    return withDesc(new Bacon.Desc(Bacon, \"fromArray\", values), Bacon.never());\n  } else {\n    var i = 0;\n    var stream = new EventStream(new Bacon.Desc(Bacon, \"fromArray\", [values]), function (sink) {\n      var unsubd = false;\n      var reply = Bacon.more;\n      var pushing = false;\n      var pushNeeded = false;\n      function push() {\n        pushNeeded = true;\n        if (pushing) {\n          return;\n        }\n        pushing = true;\n        while (pushNeeded) {\n          pushNeeded = false;\n          if (reply !== Bacon.noMore && !unsubd) {\n            var value = values[i++];\n            reply = sink(toEvent(value));\n            if (reply !== Bacon.noMore) {\n              if (i === values.length) {\n                sink(endEvent());\n              } else {\n                UpdateBarrier.afterTransaction(stream, push);\n              }\n            }\n          }\n        }\n        pushing = false;\n        return pushing;\n      };\n\n      push();\n      return function () {\n        unsubd = true;\n        return unsubd;\n      };\n    });\n    return stream;\n  }\n};\n\nBacon.EventStream.prototype.holdWhen = function (valve) {\n  var onHold = false;\n  var bufferedValues = [];\n  var src = this;\n  var srcIsEnded = false;\n  return new EventStream(new Bacon.Desc(this, \"holdWhen\", [valve]), function (sink) {\n    var composite = new CompositeUnsubscribe();\n    var subscribed = false;\n    var endIfBothEnded = function (unsub) {\n      if (typeof unsub === \"function\") {\n        unsub();\n      }\n      if (composite.empty() && subscribed) {\n        return sink(endEvent());\n      }\n    };\n    composite.add(function (unsubAll, unsubMe) {\n      return valve.subscribeInternal(function (event) {\n        if (event.hasValue()) {\n          onHold = event.value();\n          if (!onHold) {\n            var toSend = bufferedValues;\n            bufferedValues = [];\n            return (function () {\n              var result = [];\n              for (var i = 0, value; i < toSend.length; i++) {\n                value = toSend[i];\n                result.push(sink(nextEvent(value)));\n              }\n              if (srcIsEnded) {\n                result.push(sink(endEvent()));\n                unsubMe();\n              }\n              return result;\n            })();\n          }\n        } else if (event.isEnd()) {\n          return endIfBothEnded(unsubMe);\n        } else {\n          return sink(event);\n        }\n      });\n    });\n    composite.add(function (unsubAll, unsubMe) {\n      return src.subscribeInternal(function (event) {\n        if (onHold && event.hasValue()) {\n          return bufferedValues.push(event.value());\n        } else if (event.isEnd() && bufferedValues.length) {\n          srcIsEnded = true;\n          return endIfBothEnded(unsubMe);\n        } else {\n          return sink(event);\n        }\n      });\n    });\n    subscribed = true;\n    endIfBothEnded();\n    return composite.unsubscribe;\n  });\n};\n\nBacon.interval = function (delay) {\n  var value = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n  return withDesc(new Bacon.Desc(Bacon, \"interval\", [delay, value]), Bacon.fromPoll(delay, function () {\n    return nextEvent(value);\n  }));\n};\n\nBacon.$ = {};\nBacon.$.asEventStream = function (eventName, selector, eventTransformer) {\n  var _this11 = this;\n\n  if (_.isFunction(selector)) {\n    eventTransformer = selector;\n    selector = undefined;\n  }\n\n  return withDesc(new Bacon.Desc(this.selector || this, \"asEventStream\", [eventName]), Bacon.fromBinder(function (handler) {\n    _this11.on(eventName, selector, handler);\n    return function () {\n      return _this11.off(eventName, selector, handler);\n    };\n  }, eventTransformer));\n};\n\nif (typeof jQuery !== \"undefined\" && jQuery) {\n  jQuery.fn.asEventStream = Bacon.$.asEventStream;\n}\n\nif (typeof Zepto !== \"undefined\" && Zepto) {\n  Zepto.fn.asEventStream = Bacon.$.asEventStream;\n}\n\nBacon.Observable.prototype.last = function () {\n  var lastEvent;\n\n  return withDesc(new Bacon.Desc(this, \"last\", []), this.withHandler(function (event) {\n    if (event.isEnd()) {\n      if (lastEvent) {\n        this.push(lastEvent);\n      }\n      this.push(endEvent());\n      return Bacon.noMore;\n    } else {\n      lastEvent = event;\n    }\n  }));\n};\n\nBacon.Observable.prototype.log = function () {\n  for (var _len18 = arguments.length, args = Array(_len18), _key18 = 0; _key18 < _len18; _key18++) {\n    args[_key18] = arguments[_key18];\n  }\n\n  this.subscribe(function (event) {\n    if (typeof console !== \"undefined\" && typeof console.log === \"function\") {\n      console.log.apply(console, args.concat([event.log()]));\n    }\n  });\n  return this;\n};\n\nBacon.EventStream.prototype.merge = function (right) {\n  assertEventStream(right);\n  var left = this;\n  return withDesc(new Bacon.Desc(left, \"merge\", [right]), Bacon.mergeAll(this, right));\n};\n\nBacon.mergeAll = function () {\n  var streams = argumentsToObservables(arguments);\n  if (streams.length) {\n    return new EventStream(new Bacon.Desc(Bacon, \"mergeAll\", streams), function (sink) {\n      var ends = 0;\n      var smartSink = function (obs) {\n        return function (unsubBoth) {\n          return obs.dispatcher.subscribe(function (event) {\n            if (event.isEnd()) {\n              ends++;\n              if (ends === streams.length) {\n                return sink(endEvent());\n              } else {\n                return Bacon.more;\n              }\n            } else {\n              var reply = sink(event);\n              if (reply === Bacon.noMore) {\n                unsubBoth();\n              }\n              return reply;\n            }\n          });\n        };\n      };\n      var sinks = _.map(smartSink, streams);\n      return new Bacon.CompositeUnsubscribe(sinks).unsubscribe;\n    });\n  } else {\n    return Bacon.never();\n  }\n};\n\nBacon.repeatedly = function (delay, values) {\n  var index = 0;\n  return withDesc(new Bacon.Desc(Bacon, \"repeatedly\", [delay, values]), Bacon.fromPoll(delay, function () {\n    return values[index++ % values.length];\n  }));\n};\n\nBacon.repeat = function (generator) {\n  var index = 0;\n  return Bacon.fromBinder(function (sink) {\n    var flag = false;\n    var reply = Bacon.more;\n    var unsub = function () {};\n    function handleEvent(event) {\n      if (event.isEnd()) {\n        if (!flag) {\n          return flag = true;\n        } else {\n          return subscribeNext();\n        }\n      } else {\n        return reply = sink(event);\n      }\n    };\n    function subscribeNext() {\n      var next;\n      flag = true;\n      while (flag && reply !== Bacon.noMore) {\n        next = generator(index++);\n        flag = false;\n        if (next) {\n          unsub = next.subscribeInternal(handleEvent);\n        } else {\n          sink(endEvent());\n        }\n      }\n      return flag = true;\n    };\n    subscribeNext();\n    return function () {\n      return unsub();\n    };\n  });\n};\n\nBacon.retry = function (options) {\n  if (!_.isFunction(options.source)) {\n    throw new Exception(\"'source' option has to be a function\");\n  }\n  var source = options.source;\n  var retries = options.retries || 0;\n  var retriesDone = 0;\n  var delay = options.delay || function () {\n    return 0;\n  };\n  var isRetryable = options.isRetryable || function () {\n    return true;\n  };\n  var finished = false;\n  var error = null;\n\n  return withDesc(new Bacon.Desc(Bacon, \"retry\", [options]), Bacon.repeat(function (count) {\n    function valueStream() {\n      return source(count).endOnError().withHandler(function (event) {\n        if (event.isError()) {\n          error = event;\n          if (!(isRetryable(error.error) && (retries === 0 || retriesDone < retries))) {\n            finished = true;\n            return this.push(event);\n          }\n        } else {\n          if (event.hasValue()) {\n            error = null;\n            finished = true;\n          }\n          return this.push(event);\n        }\n      });\n    }\n\n    if (finished) {\n      return null;\n    } else if (error) {\n      var context = {\n        error: error.error,\n        retriesDone: retriesDone\n      };\n      var pause = Bacon.later(delay(context)).filter(false);\n      retriesDone++;\n      return pause.concat(Bacon.once().flatMap(valueStream));\n    } else {\n      return valueStream();\n    }\n  }));\n};\n\nBacon.sequentially = function (delay, values) {\n  var index = 0;\n  return withDesc(new Bacon.Desc(Bacon, \"sequentially\", [delay, values]), Bacon.fromPoll(delay, function () {\n    var value = values[index++];\n    if (index < values.length) {\n      return value;\n    } else if (index === values.length) {\n      return [value, endEvent()];\n    } else {\n      return endEvent();\n    }\n  }));\n};\n\nBacon.Observable.prototype.skip = function (count) {\n  return withDesc(new Bacon.Desc(this, \"skip\", [count]), this.withHandler(function (event) {\n    if (!event.hasValue()) {\n      return this.push(event);\n    } else if (count > 0) {\n      count--;\n      return Bacon.more;\n    } else {\n      return this.push(event);\n    }\n  }));\n};\n\nBacon.EventStream.prototype.skipUntil = function (starter) {\n  var started = starter.take(1).map(true).toProperty(false);\n  return withDesc(new Bacon.Desc(this, \"skipUntil\", [starter]), this.filter(started));\n};\n\nBacon.EventStream.prototype.skipWhile = function (f) {\n  assertObservableIsProperty(f);\n  var ok = false;\n\n  for (var _len19 = arguments.length, args = Array(_len19 > 1 ? _len19 - 1 : 0), _key19 = 1; _key19 < _len19; _key19++) {\n    args[_key19 - 1] = arguments[_key19];\n  }\n\n  return convertArgsToFunction(this, f, args, function (f) {\n    return withDesc(new Bacon.Desc(this, \"skipWhile\", [f]), this.withHandler(function (event) {\n      if (ok || !event.hasValue() || !f(event.value())) {\n        if (event.hasValue()) {\n          ok = true;\n        }\n        return this.push(event);\n      } else {\n        return Bacon.more;\n      }\n    }));\n  });\n};\n\nBacon.Observable.prototype.slidingWindow = function (n) {\n  var minValues = arguments.length <= 1 || arguments[1] === undefined ? 0 : arguments[1];\n\n  return withDesc(new Bacon.Desc(this, \"slidingWindow\", [n, minValues]), this.scan([], function (window, value) {\n    return window.concat([value]).slice(-n);\n  }).filter(function (values) {\n    return values.length >= minValues;\n  }));\n};\n\nvar spies = [];\nvar registerObs = function (obs) {\n  if (spies.length) {\n    if (!registerObs.running) {\n      try {\n        registerObs.running = true;\n        spies.forEach(function (spy) {\n          spy(obs);\n        });\n      } finally {\n        delete registerObs.running;\n      }\n    }\n  }\n};\n\nBacon.spy = function (spy) {\n  return spies.push(spy);\n};\n\nBacon.Property.prototype.startWith = function (seed) {\n  return withDesc(new Bacon.Desc(this, \"startWith\", [seed]), this.scan(seed, function (prev, next) {\n    return next;\n  }));\n};\n\nBacon.EventStream.prototype.startWith = function (seed) {\n  return withDesc(new Bacon.Desc(this, \"startWith\", [seed]), Bacon.once(seed).concat(this));\n};\n\nBacon.Observable.prototype.takeWhile = function (f) {\n  assertObservableIsProperty(f);\n\n  for (var _len20 = arguments.length, args = Array(_len20 > 1 ? _len20 - 1 : 0), _key20 = 1; _key20 < _len20; _key20++) {\n    args[_key20 - 1] = arguments[_key20];\n  }\n\n  return convertArgsToFunction(this, f, args, function (f) {\n    return withDesc(new Bacon.Desc(this, \"takeWhile\", [f]), this.withHandler(function (event) {\n      if (event.filter(f)) {\n        return this.push(event);\n      } else {\n        this.push(endEvent());\n        return Bacon.noMore;\n      }\n    }));\n  });\n};\n\nBacon.Observable.prototype.throttle = function (delay) {\n  return this.delayChanges(new Bacon.Desc(this, \"throttle\", [delay]), function (changes) {\n    return changes.bufferWithTime(delay).map(function (values) {\n      return values[values.length - 1];\n    });\n  });\n};\n\nObservable.prototype.firstToPromise = function (PromiseCtr) {\n  var _this12 = this;\n\n  if (typeof PromiseCtr !== \"function\") {\n    if (typeof Promise === \"function\") {\n      PromiseCtr = Promise;\n    } else {\n      throw new Exception(\"There isn't default Promise, use shim or parameter\");\n    }\n  }\n\n  return new PromiseCtr(function (resolve, reject) {\n    return _this12.subscribe(function (event) {\n      if (event.hasValue()) {\n        resolve(event.value());\n      }\n      if (event.isError()) {\n        reject(event.error);\n      }\n\n      return Bacon.noMore;\n    });\n  });\n};\n\nObservable.prototype.toPromise = function (PromiseCtr) {\n  return this.last().firstToPromise(PromiseCtr);\n};\n\nBacon[\"try\"] = function (f) {\n  return function (value) {\n    try {\n      return Bacon.once(f(value));\n    } catch (e) {\n      return new Bacon.Error(e);\n    }\n  };\n};\n\nBacon.update = function (initial) {\n  function lateBindFirst(f) {\n    return function () {\n      for (var _len22 = arguments.length, args = Array(_len22), _key22 = 0; _key22 < _len22; _key22++) {\n        args[_key22] = arguments[_key22];\n      }\n\n      return function (i) {\n        return f.apply(undefined, [i].concat(args));\n      };\n    };\n  }\n\n  for (var _len21 = arguments.length, patterns = Array(_len21 > 1 ? _len21 - 1 : 0), _key21 = 1; _key21 < _len21; _key21++) {\n    patterns[_key21 - 1] = arguments[_key21];\n  }\n\n  var i = patterns.length - 1;\n  while (i > 0) {\n    if (!(patterns[i] instanceof Function)) {\n      patterns[i] = _.always(patterns[i]);\n    }\n    patterns[i] = lateBindFirst(patterns[i]);\n    i = i - 2;\n  }\n  return withDesc(new Bacon.Desc(Bacon, \"update\", [initial].concat(patterns)), Bacon.when.apply(Bacon, patterns).scan(initial, function (x, f) {\n    return f(x);\n  }));\n};\n\nBacon.zipAsArray = function () {\n  for (var _len23 = arguments.length, args = Array(_len23), _key23 = 0; _key23 < _len23; _key23++) {\n    args[_key23] = arguments[_key23];\n  }\n\n  var streams = argumentsToObservables(args);\n  return withDesc(new Bacon.Desc(Bacon, \"zipAsArray\", streams), Bacon.zipWith(streams, function () {\n    for (var _len24 = arguments.length, xs = Array(_len24), _key24 = 0; _key24 < _len24; _key24++) {\n      xs[_key24] = arguments[_key24];\n    }\n\n    return xs;\n  }));\n};\n\nBacon.zipWith = function () {\n  for (var _len25 = arguments.length, args = Array(_len25), _key25 = 0; _key25 < _len25; _key25++) {\n    args[_key25] = arguments[_key25];\n  }\n\n  var observablesAndFunction = argumentsToObservablesAndFunction(args);\n  var streams = observablesAndFunction[0];\n  var f = observablesAndFunction[1];\n\n  streams = _.map(function (s) {\n    return s.toEventStream();\n  }, streams);\n  return withDesc(new Bacon.Desc(Bacon, \"zipWith\", [f].concat(streams)), Bacon.when(streams, f));\n};\n\nBacon.Observable.prototype.zip = function (other, f) {\n  return withDesc(new Bacon.Desc(this, \"zip\", [other]), Bacon.zipWith([this, other], f || Array));\n};\n\nfunction ESObservable(observable) {\n  this.observable = observable;\n}\n\nESObservable.prototype.subscribe = function (observerOrOnNext, onError, onComplete) {\n  var observer = typeof observerOrOnNext === 'function' ? { next: observerOrOnNext, error: onError, complete: onComplete } : observerOrOnNext;\n  var subscription = {\n    closed: false,\n    unsubscribe: function () {\n      subscription.closed = true;\n      cancel();\n    }\n  };\n\n  var cancel = this.observable.subscribe(function (event) {\n    if (event.isError()) {\n      if (observer.error) observer.error(event.error);\n      subscription.unsubscribe();\n    } else if (event.isEnd()) {\n      subscription.closed = true;\n      if (observer.complete) observer.complete();\n    } else if (observer.next) {\n      observer.next(event.value());\n    }\n  });\n  return subscription;\n};\n\nESObservable.prototype[symbol('observable')] = function () {\n  return this;\n};\n\nBacon.Observable.prototype.toESObservable = function () {\n  return new ESObservable(this);\n};\n\nBacon.Observable.prototype[symbol('observable')] = Bacon.Observable.prototype.toESObservable;\n\nBacon.fromESObservable = function (_observable) {\n  var observable;\n  if (_observable[symbol(\"observable\")]) {\n    observable = _observable[symbol(\"observable\")]();\n  } else {\n    observable = _observable;\n  }\n\n  var desc = new Bacon.Desc(Bacon, \"fromESObservable\", [observable]);\n  return new Bacon.EventStream(desc, function (sink) {\n    var cancel = observable.subscribe({\n      error: function () {\n        sink(new Bacon.Error());\n        sink(new Bacon.End());\n      },\n      next: function (value) {\n        sink(new Bacon.Next(value, true));\n      },\n      complete: function () {\n        sink(new Bacon.End());\n      }\n    });\n\n    if (cancel.unsubscribe) {\n      return function () {\n        cancel.unsubscribe();\n      };\n    } else {\n      return cancel;\n    }\n  });\n};\n\nif (typeof define !== \"undefined\" && define !== null && define.amd != null) {\n  define([], function () {\n    return Bacon;\n  });\n  if (typeof this !== \"undefined\" && this !== null) {\n    this.Bacon = Bacon;\n  }\n} else if (typeof module !== \"undefined\" && module !== null && module.exports != null) {\n  module.exports = Bacon;\n  Bacon.Bacon = Bacon;\n} else {\n    this.Bacon = Bacon;\n  }\n}).call(this);\n"]}